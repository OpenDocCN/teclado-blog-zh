<html>
<head>
<title>Day 29: Exercise Solutions | Teclado</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1>第29天:锻炼解决方案| Teclado</h1>
<blockquote>原文：<a href="https://blog.teclado.com/python-30-day-29-exercise-solutions/">https://blog.teclado.com/python-30-day-29-exercise-solutions/</a></blockquote><div><article class="pb-12 prose prose-p:font-copy col-start-2 dark:prose-invert">
                    
                    <p>这是我们在Python 系列<a href="https://blog.teclado.com/30-days-of-python/"> 30天中</a><a href="/30-days-of-python/python-30-day-29-decorators">第29天练习</a>的解决方案。在检查解决方案之前，请确保您亲自尝试了该练习！</p>
<h3>1)制作一个装饰器，它调用给定的函数两次。你可以假设这些函数不返回任何重要的东西，但是它们可以接受参数。</h3>
<p>你可以随便称呼你的室内设计师，但我在这里要说<code>double</code>。</p>


<p>我们知道我们需要马上做的事情很少。我们需要我们的装饰器接受一个函数作为参数，并且我们需要返回一个对我们在装饰器的函数体中定义的函数的引用。</p>
<p>使用<code>wraps</code>保存原始的函数名和文档也是一个好主意。</p>
<div class="codehilite"><pre><span/><code><span class="kn">from</span> <span class="nn">functools</span> <span class="kn">import</span> <span class="n">wraps</span>

<span class="k">def</span> <span class="nf">double</span><span class="p">(</span><span class="n">func</span><span class="p">):</span>
    <span class="nd">@wraps</span><span class="p">(</span><span class="n">func</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">inner</span><span class="p">():</span>
        <span class="k">pass</span>

    <span class="k">return</span> <span class="n">inner</span>
</code></pre></div>

<p>因为我们的函数可以接受参数，所以我们应该使用<code>*args</code>、<code>**kwargs**</code>将<code>inner</code>函数定义为接受任意数量的位置和关键字参数。然后我们应该在调用<code>inner</code>中的函数时传递这些参数。</p>
<div class="codehilite"><pre><span/><code><span class="kn">from</span> <span class="nn">functools</span> <span class="kn">import</span> <span class="n">wraps</span>

<span class="k">def</span> <span class="nf">double</span><span class="p">(</span><span class="n">func</span><span class="p">):</span>
    <span class="nd">@wraps</span><span class="p">(</span><span class="n">func</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">inner</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="n">func</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="n">func</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">inner</span>
</code></pre></div>

<h3>2)假设您有一个名为<code>books</code>的列表，您的应用程序中有几个函数与它进行交互。写一个decorator，使得你的函数只有在<code>books</code>不为空时才运行。</h3>
<p>让我们从设置我们通常的装饰样板开始。我还将创建一个名为<code>books</code>的列表。</p>
<div class="codehilite"><pre><span/><code><span class="kn">from</span> <span class="nn">functools</span> <span class="kn">import</span> <span class="n">wraps</span>

<span class="n">books</span> <span class="o">=</span> <span class="p">[]</span>

<span class="k">def</span> <span class="nf">requires_content</span><span class="p">(</span><span class="n">func</span><span class="p">):</span>
    <span class="nd">@wraps</span><span class="p">(</span><span class="n">func</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">inner</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="k">pass</span>

    <span class="k">return</span> <span class="n">inner</span>
</code></pre></div>

<p>这里的实际逻辑相当简单。我们只需要检查<code>inner</code>里面<code>books</code>的真值，只有条件求值为<code>True</code>时才调用函数。</p>
<div class="codehilite"><pre><span/><code><span class="kn">from</span> <span class="nn">functools</span> <span class="kn">import</span> <span class="n">wraps</span>

<span class="n">books</span> <span class="o">=</span> <span class="p">[]</span>

<span class="k">def</span> <span class="nf">requires_content</span><span class="p">(</span><span class="n">func</span><span class="p">):</span>
    <span class="nd">@wraps</span><span class="p">(</span><span class="n">func</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">inner</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">books</span><span class="p">:</span>
            <span class="n">func</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">inner</span>
</code></pre></div>

<p>我们可能还应该返回<code>func</code>的返回值，以防函数返回什么。</p>
<div class="codehilite"><pre><span/><code><span class="kn">from</span> <span class="nn">functools</span> <span class="kn">import</span> <span class="n">wraps</span>

<span class="n">books</span> <span class="o">=</span> <span class="p">[]</span>

<span class="k">def</span> <span class="nf">requires_content</span><span class="p">(</span><span class="n">func</span><span class="p">):</span>
    <span class="nd">@wraps</span><span class="p">(</span><span class="n">func</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">inner</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">books</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">func</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">inner</span>
</code></pre></div>

<h3>3)编写一个名为<code>printer</code>的装饰器，让任何被装饰的函数打印它们的返回值。如果给定函数的返回值是<code>None</code>，<code>printer</code>应该什么都不做。</h3>
<p>这个练习与上一个非常相似:我们只需要一个基于函数返回值的条件，而不是某个外部变量。</p>
<p>让我们再次从样板文件开始。</p>
<div class="codehilite"><pre><span/><code><span class="kn">from</span> <span class="nn">functools</span> <span class="kn">import</span> <span class="n">wraps</span>

<span class="k">def</span> <span class="nf">printer</span><span class="p">(</span><span class="n">func</span><span class="p">):</span>
    <span class="nd">@wraps</span><span class="p">(</span><span class="n">func</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">inner</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="k">pass</span>

    <span class="k">return</span> <span class="n">inner</span>
</code></pre></div>

<p>这里的第一步是实际调用<code>inner</code>中的函数。</p>
<div class="codehilite"><pre><span/><code><span class="kn">from</span> <span class="nn">functools</span> <span class="kn">import</span> <span class="n">wraps</span>

<span class="k">def</span> <span class="nf">printer</span><span class="p">(</span><span class="n">func</span><span class="p">):</span>
    <span class="nd">@wraps</span><span class="p">(</span><span class="n">func</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">inner</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="n">return_value</span> <span class="o">=</span> <span class="n">func</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">inner</span>
</code></pre></div>

<p>现在我们需要检查存储在<code>return_value</code>中的值。</p>
<p>我们在这里不只是检查<code>return_value</code>的真值，这一点非常重要，因为函数可能会返回大量其他假值。例如，<code>0</code>、<code>False</code>或<code>[]</code>。</p>
<div class="codehilite"><pre><span/><code><span class="kn">from</span> <span class="nn">functools</span> <span class="kn">import</span> <span class="n">wraps</span>

<span class="k">def</span> <span class="nf">printer</span><span class="p">(</span><span class="n">func</span><span class="p">):</span>
    <span class="nd">@wraps</span><span class="p">(</span><span class="n">func</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">inner</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="n">return_value</span> <span class="o">=</span> <span class="n">func</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">return_value</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="n">return_value</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">inner</span>
</code></pre></div>

<p>注意检查<code>None</code>时的习语是使用<code>is</code>和<code>is not</code>，而不是<code>==</code>和<code>!=</code>。这是可行的，因为<code>None</code>的所有实例在内存中实际上都是相同的值。</p> 
                </article>
            
            </div>    
</body>
</html>