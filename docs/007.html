<html>
<head>
<title>Query string arguments in REST APIs with Flask</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1>使用Flask在REST APIs中查询字符串参数</h1>
<blockquote>原文：<a href="https://blog.teclado.com/query-string-arguments-in-flask-rest-apis/">https://blog.teclado.com/query-string-arguments-in-flask-rest-apis/</a></blockquote><div><div class="post-content">
<p>查询字符串参数是添加在URL末尾的值，遵循<code>name1=value1&amp;name2=value2</code>的格式。您可以用“与”符号分隔多个值(如图所示)。查询字符串参数通过问号与URL的主要部分分开。</p>
<p>因此，带有查询字符串参数的完整URL可能如下所示:</p>
<pre><code>http://your-api.com/item/?tag=furniture
</code></pre>
<p>要获得多个值，您需要包含两个或多个相同的查询字符串参数:</p>
<pre><code>http://your-api.com/item/?tag=furniture&amp;tag=office
</code></pre>
<p>在我的使用Flask和Python的REST API课程中，我们使用Flask-Smorest库构建REST API。在这篇博文中，让我向您展示如何将查询字符串参数与Flask-Smorest一起使用。</p>
<p>如果你想看视频，请点击这里:</p>
<iframe src="https://www.youtube.com/embed/oJGRvtJbnmU" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" allowfullscreen="">VIDEO</iframe>
<h2 id="how-to-access-query-string-values-in-a-flask-endpoint">如何访问Flask端点中的查询字符串值</h2>
<p>在Flask端点中访问查询字符串值相对简单:</p>
<ul>
<li>从<code>flask</code>导入<code>request</code>代理</li>
<li>查询字符串参数存储在<code>request.args</code>下一个类似dict的值中。</li>
</ul>
<p>这里有一个示例端点，它返回数据库中的所有商店。</p>
<pre><code class="language-python">@app.route("/store")
def get_stores():
    return [{"name": store.name, "id": store.id} for store in StoreModel.query.all()]
</code></pre>
<p>现在，假设您想要添加一个查询字符串参数值来按名称过滤商店。我们的API用户将发送给我们<code>name=Tec</code>，API应该响应名称以<code>Tec</code>开头的商店。</p>
<p>为了获得查询字符串参数值，我们使用<code>request.args.get("name")</code>:</p>
<pre><code class="language-python"># at top of file
from flask import app, request


# in endpoint
@app.route("/store")
def get_stores():
    name = request.args.get("name")
    return [{"name": store.name, "id": store.id} for store in StoreModel.query.all()]
</code></pre>
<p>然后我们可以在调用<code>.all()</code>之前给<code>.query</code>添加一个过滤器:</p>
<pre><code class="language-python"># at top of file
from flask import request


# in endpoint
@app.route("/store")
def get_stores():
    name = request.args.get("name")
    return [
        {"name": store.name, "id": store.id}
        for store in StoreModel.query.filter(StoreModel.name.startswith(name)).all()
    ]
</code></pre>
<p>顺便说一下，如果您想在商店名称的任何地方搜索给定值，而不是<code>.startswith</code>，您可以使用:</p>
<pre><code class="language-python">StoreModel.query.filter(StoreModel.name.like(f"%{name}%")).all()
</code></pre>
<h2 id="accessing-a-list-of-values-in-a-query-string-argument">访问查询字符串参数中的值列表</h2>
<p>首先，确保用户像这样发送查询字符串:</p>
<pre><code class="language-text">?tags=furniture&amp;tags=office
</code></pre>
<p>然后在Flask中，像这样访问这些值:</p>
<pre><code class="language-python">request.args.getlist("tags")  # ["furniture", "office"]
</code></pre>
<p>如果使用<code>request.args.get("tags")</code>，那么只返回第一个标签值。</p>
<p>或者，您<em>可以</em>(但我不推荐)，这样做来处理逗号分隔的值:</p>
<pre><code class="language-python">request.args.get("tags").split(",")
</code></pre>
<p>我可以预见的问题是，如果收到的值包含逗号，您可能会遇到麻烦。对于标签<em>和</em>，这种情况可能不会发生，但对于其他值，这种情况可能会发生。您最好使用推荐的方法，即获取多个查询字符串参数并使用<code>.getlist()</code>。</p>
<h2 id="how-to-access-query-string-arguments-in-a-flask-smorest-resource">如何访问Flask-Smorest资源中的查询字符串参数</h2>
<p>这里有一个示例<code>Resource</code>类，它返回数据库中的所有商店。这类似于我们之前展示的端点。</p>
<pre><code class="language-python">@blp.route("/store")
class StoreList(MethodView):
    @blp.response(200, StoreSchema(many=True))
    def get(self):
        return StoreModel.query.all()
</code></pre>
<p>现在，您希望添加与前面相同的查询字符串参数，以便按名称过滤商店。你可以简单地像在vanilla Flask中一样，通过导入<code>request</code>，然后使用<code>request.args.get()</code>。</p>
<p>但是Flask-Smorest的主要好处之一是文档和验证，所以让我们试着做得更好。</p>
<p>首先，我们将为查询字符串参数定义一个模式:</p>
<pre><code class="language-python">class StoreSearchQueryArgs(BaseSchema):
    name: str | None
</code></pre>
<p>然后我们用一个<code>@blp.arguments()</code>装饰器来装饰<code>get</code>方法，确保通过<code>location="query"</code>，就像这样:</p>
<pre><code class="language-python">@blp.route("/store")
class StoreList(MethodView):
    @blp.arguments(StoreSearchQueryArgs, location="query")
    @blp.response(200, StoreSchema(many=True))
    def get(self, search_values):
        return StoreModel.query.all()
</code></pre>
<p>然后我们可以在调用<code>.all()</code>之前将过滤器添加到<code>.query</code>:</p>
<pre><code class="language-python">@blp.route("/store")
class StoreList(MethodView):
    @blp.arguments(StoreSearchQueryArgs, location="query")
    @blp.response(200, StoreSchema(many=True))
    def get(self, search_values):
        return StoreModel.query.filter(StoreModel.name.startswith(search_values.get("name", ""))).all()
</code></pre>
<p>对于一个完整的Flask-Smorest应用程序，你可以看看这个要点。</p>
<p>好了，这就是这篇博文的全部内容！我只是想向您展示如何在Flask中使用查询字符串参数，重点是使用Flask-Smorest的REST APIs。</p>
<p>如果你想了解更多关于用Flask开发REST API的知识，可以考虑看看我们的课程:<a href="https://go.tecla.do/rest-apis-sale">用Flask和Python开发REST API</a>。这是一个完整的视频课程，涵盖了您需要的一切，从基础到使用数据库、部署、后台任务等等！</p>

</div>
</div>    
</body>
</html>