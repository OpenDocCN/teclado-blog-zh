<html>
<head>
<title>How to interact with REST APIs from JavaScript</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1>如何从JavaScript与REST APIs交互</h1>
<blockquote>原文：<a href="https://blog.teclado.com/how-to-interact-with-rest-apis-from-javascript/">https://blog.teclado.com/how-to-interact-with-rest-apis-from-javascript/</a></blockquote><div><div class="post-content">
<p>这篇文章是对我们REST API开发课程的学生的一个常见问题的回应。</p><p>在那里，我们教如何使用Python创建REST APIs，但不教如何使用它们。通常你会创建一个REST API来标准化和共享对资源的访问，比如数据库。例如，您可能希望允许移动应用程序和web应用程序通过REST API访问您的数据库。</p><p>当然，为了做到这一点，您需要知道如何在您的移动应用程序或web应用程序中使用REST API！</p><p>在这篇文章中，我们将看看如何使用JavaScript与REST API交互，以便您的web应用程序使用它。</p><p>如果你想继续学习，<a href="https://github.com/tecladocode/interacting-with-apis-javascript">这里有一个GitHub库</a>,里面有一个Flask示例应用程序和这篇博文中提到的所有JavaScript示例。</p><h2 id="what-to-interact-means">“互动”是什么意思</h2><p>在REST APIs的上下文中，“交互”意味着向API发出请求并获得响应。</p><p>那么，我们如何使用JavaScript向REST API发出请求呢？</p><p>有几种方法可以做到。</p><h3 id="make-http-requests-with-vanilla-javascript">用普通的JavaScript发出HTTP请求</h3><p>用JavaScript <em>发出HTTP请求而不使用</em>任何库的方法需要大量的输入，所以通常你不会使用这种方法。不过，反正知道了还是好的！</p><p>下面是如何使用普通JavaScript执行GET请求:</p><pre><code class="language-js">const request = new XMLHttpRequest();
const url = 'http://localhost:5000/movies';
request.open("GET", url);
request.send();

request.onload = (e) =&gt; {
    alert(request.response);
}
</code></pre>
<p>这里我们首先创建一个新的<code>XMLHttpRequest</code>。这是保存我们正在进行的HTTP请求的数据，然后将它发送给API(我在本地运行，因此url在<code>localhost</code>中)。</p><p>然后我们打开请求，传递方法和URL，这里的方法是<code>"GET"</code>，从API中检索数据时经常用到。</p><p><code>XMLHttpRequest</code>是异步的，这意味着在收到响应之前，运行<code>.send()</code>不会阻塞应用程序。相反，接收和处理响应可以通过一个事件处理程序来完成。</p><p>这就是<code>.onload</code>的作用。将一个函数定义为该属性的值，它将在响应到达时运行。</p><h3 id="sending-form-data-with-vanilla-javascript">用普通JavaScript发送表单数据</h3><p>发送表单数据有两种主要方式:使用HTML和使用JavaScript。</p><p>如果可以，用HTML发送表单数据将会简单得多。为此，您需要一个包含表单和提交按钮的HTML页面。然后，当您按下submit按钮时，HTML会为您构建并发送请求。</p><p>大概是这样的:</p><pre><code class="language-html">&lt;!DOCTYPE html&gt;
&lt;html&gt;
    &lt;head&gt;

    &lt;/head&gt;
    &lt;body&gt;
        &lt;form action="http://localhost:5000" method="POST"&gt;
            &lt;label&gt;
                Title: &lt;input type="text" name="title" placeholder="Movie name" /&gt;
            &lt;/label&gt;
            &lt;label&gt;
                Year: &lt;input type="text" name="year" placeholder="1994" /&gt;
            &lt;/label&gt;
            &lt;input type="submit" value="Submit" /&gt;
        &lt;/form&gt;
    &lt;/body&gt;
&lt;/html&gt;
</code></pre>
<p>注意，这根本没有使用JavaScript。但是，如果您希望发送代码在您的JavaScript中，而不是使用HTML，您可以这样做。</p><p>您可以这样做，使用<code>XMLHttpRequest</code>:</p><pre><code class="language-js">const formData = new FormData();

formData.append("title", "The Matrix");
formData.append("year", "1999");

const response = new XMLHttpRequest();
response.open("POST", "http://localhost:5000/");
response.send(formData);

response.onload = (e) =&gt; {
    alert(response.response);
}
</code></pre>
<p>这看起来与我们之前的相似，但是现在我们首先创建一个<code>FormData</code>对象，并向它追加我们想要的字段。</p><p>那么当我们<code>.open()</code>的时候，我们说方法是<code>"POST"</code>。这就是我们的示例API在接收数据时所期望的，但是在您的API中可能会有所不同。</p><p>最后，当执行<code>.send()</code>时，确保包含表单数据，以便它被发送到API。</p><h3 id="sending-json-data-with-vanilla-javascript">用普通JavaScript发送JSON数据</h3><p>发送JSON数据仅仅意味着发送一个字符串，并告诉API这个字符串代表什么。</p><p>因此，在这个例子中，我们将发送包含JSON对象的字符串，以及一个<em>头</em>，告诉API我们的数据是JSON数据。</p><pre><code class="language-js">const response = new XMLHttpRequest();

const json = JSON.stringify({
    title: "The Matrix",
    year: "1999"
});

response.open("POST", 'http://localhost:5000/')
response.setRequestHeader('Content-Type', 'application/json');

response.send(json);

response.onload = (e) =&gt; {
    alert(response.response);
}
</code></pre>
<p>我们需要设置的头是<code>Content-Type</code>，值是<code>application/json</code>。这使得我们的API知道它正在接收JSON数据。</p><p>然而，我们在<code>.send()</code>中使用的数据不能是JavaScript对象。它必须是一个字符串——你可以通过做<code>JSON.stringify()</code>把JavaScript对象变成字符串。</p><h3 id="getting-data-with-javascript-s-fetch">用JavaScript的fetch获取数据</h3><p>较新版本的JavaScript(称为ES6)带有一个名为<code>fetch()</code>的函数，它极大地简化并改进了发送和接收请求和响应的传统方式。</p><p>要使用<code>fetch()</code>而不是<code>XMLHttpRequest</code>来检索数据，您必须这样做。一定要确保运行这段代码的浏览器支持ES6。Chrome是个不错的选择。</p><pre><code class="language-js">const url = 'http://localhost:5000/movies';
fetch(url)
.then(data =&gt; data.json())
.then((json) =&gt; {
    alert(JSON.stringify(json));
})
</code></pre>
<p>如果你不确定你的用户的浏览器是否支持<code>fetch()</code>，通常我们所做的是通过使用一个叫做transpiler的工具把现代的JavaScript代码转换成旧的代码。</p><p>在这段代码中，我们使用ES6中承诺的<code>.then()</code>语法来告诉JavaScript在响应到达时做什么，而不是使用事件处理程序。</p><p>这更干净，并且将与响应处理相关的代码与发出请求的代码放在同一个地方。</p><h3 id="sending-json-with-javascript-s-fetch">用JavaScript的fetch发送JSON</h3><p>用<code>fetch()</code>发送数据可能看起来相当冗长——就像用<code>XMLHttpRequest</code>一样，但是我认为当你知道它的意思时，它更容易阅读！</p><p>看看这个:</p><pre><code class="language-js">const url = 'http://localhost:5000/';
const data = { title: "The Matrix", year: "1994" };

fetch(
    url,
    {
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify(data),
        method: "POST"
    }
)
.then(data =&gt; data.json())
.then((json) =&gt; {
    alert(JSON.stringify(json));
});
</code></pre>
<p>这段代码的主要部分是我们用两个参数调用<code>fetch()</code>:<code>url</code>和<code>options</code>。</p><p><code>options</code>包括<code>headers</code>、<code>body</code>和<code>method</code>。这包含了我们的请求成功发送所需的所有内容。</p><p>因为所有的选项都在一个地方，所以我认为它比<code>XMLHttpRequest</code>更具可读性。</p><h2 id="conclusion">结论</h2><p>还有更多的库可以用来用JavaScript发送HTTP请求，比如jQuery、axios、Angular的HttpClient等等。然而，只要有可能，我会坚持使用<code>fetch()</code>，因为这是新的、现代的、推荐的方法。</p><p>感谢您阅读今天的博文，我希望它对您的REST API开发有用！</p><p>如果你想学习如何创建REST API，请查看我们的<a href="https://go.tecla.do/rest-apis-sale">REST API与Flask和Python课程</a>。此外，注册我们的邮件列表，因为我们每个月都与我们的订户共享折扣代码！</p><p>下次见！</p>
</div>
</div>    
</body>
</html>