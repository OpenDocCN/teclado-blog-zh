<html>
<head>
<title>Day 18 Project: JSON Reading List | Teclado</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1>第18天项目:JSON阅读清单| Teclado</h1>
<blockquote>原文：<a href="https://blog.teclado.com/python-30-day-18-project/">https://blog.teclado.com/python-30-day-18-project/</a></blockquote><div><article class="pb-12 prose prose-p:font-copy col-start-2 dark:prose-invert">
                    
                    <p>欢迎来到Python 系列<a href="https://blog.teclado.com/30-days-of-python/"> 30天的第18天项目！今天我们将最后一次修改我们的阅读列表应用程序，来练习一个非常重要的模块<code>json</code>。</a></p>
<p><code>json</code>模块用于对JSON数据进行序列化和解序列化。这只是一种奇特的说法，它提供了一种将我们的Python代码转换成JSON格式，以及从JSON转换回Python的方法。</p>
<p>在我们开始简介之前，让我们稍微谈一下JSON格式是什么样子，以及我们将在<code>json</code>模块中使用的重要函数。</p>
<h2>JSON</h2>
<p>JSON代表<strong>J</strong>ava<strong>S</strong>script<strong>O</strong>object<strong>N</strong>rotation，和CSV一样，它是一种非常常见的数据存储格式。它在网络上被广泛使用，特别是在网站或应用程序和服务器之间共享信息。</p>
<p>JSON格式实际上对我们来说非常熟悉，因为它几乎与Python字典和列表的格式相同。</p>
<p>下面是一个JSON对象的例子，它大致类似于一个字典:</p>
<div class="codehilite"><pre><span/><code><span class="p">{</span>
    <span class="s2">"title"</span><span class="p">:</span> <span class="s2">"1Q84"</span><span class="p">,</span>
    <span class="s2">"author"</span><span class="p">:</span> <span class="s2">"Haruki Murakami"</span><span class="p">,</span>
    <span class="s2">"year"</span><span class="p">:</span> <span class="mi">2009</span><span class="p">,</span>
    <span class="s2">"read"</span><span class="p">:</span> <span class="n">true</span>
<span class="p">}</span>
</code></pre></div>

<p>对于JSON，有一些事情我们必须小心记住。首先是所有的字符串，包括键名，必须使用双引号(<code>"</code>)。单引号(<code>'</code>)在JSON中无效。</p>
<p>我们要注意的第二件事是关键字<code>true</code>。这在JSON中完全是小写的，不像在Python中我们使用<code>True</code>。在JSON中<code>false</code>也是一个有效的布尔值，和Python中的<code>False</code>一样。</p>
<p>如果我们希望有几个独立的JSON对象，我们的项目就是这种情况，我们需要将对象包装在一个JSON数组中，这类似于一个Python列表。</p>
<div class="codehilite"><pre><span/><code><span class="p">[</span>
    <span class="p">{</span>
        <span class="s2">"title"</span><span class="p">:</span> <span class="s2">"1Q84"</span><span class="p">,</span>
        <span class="s2">"author"</span><span class="p">:</span> <span class="s2">"Haruki Murakami"</span><span class="p">,</span>
        <span class="s2">"year"</span><span class="p">:</span> <span class="mi">2009</span><span class="p">,</span>
        <span class="s2">"read"</span><span class="p">:</span> <span class="n">true</span>
    <span class="p">},</span>
    <span class="p">{</span>
        <span class="s2">"title"</span><span class="p">:</span> <span class="s2">"The Picture of Dorian Gray"</span><span class="p">,</span>
        <span class="s2">"author"</span><span class="p">:</span> <span class="s2">"Oscar Wilde"</span><span class="p">,</span>
        <span class="s2">"year"</span><span class="p">:</span> <span class="mi">1890</span><span class="p">,</span>
        <span class="s2">"read"</span><span class="p">:</span> <span class="n">false</span> 
    <span class="p">}</span>
<span class="p">]</span>
</code></pre></div>

<p>为了使JSON有效，我们必须总是有一个顶级JSON对象，或者一个顶级JSON数组。这意味着空文件是<strong>而不是</strong>有效的JSON。</p>
<p>我们可以尽可能深地嵌套这些结构，所以拥有一个包含填充了其他对象的对象数组的对象数组是完全合法的。这种非常复杂的格式的JSON并不少见。</p>
<p>虽然这有点困难，但我们可以编写代码来遍历这些JSON数据，并将其转换为Python，但谢天谢地，我们自己不必这么做。这是一个非常常见的操作，因此我们在标准库中有一个<code>json</code>模块专门用于这个目的。</p>
<h2><code>json</code>模块</h2>
<p>在<code>json</code>模块中，我们需要了解两个重要的功能。</p>
<p>第一个函数是<code>json.load</code>，它将允许我们从文件中获取JSON数据，并将其转换为标准的Python类型，如字典、列表、整数、字符串、<em>等</em>。</p>
<p>这个函数要求文件是有效的JSON格式，所以我们必须小心不要违反我之前提到的任何规则。这包括不要试图读取空文件！</p>
<p>我们将这样使用它:</p>
<div class="codehilite"><pre><span/><code><span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s2">"books.json"</span><span class="p">,</span> <span class="s2">"r"</span><span class="p">)</span> <span class="k">as</span> <span class="n">reading_list</span><span class="p">:</span>
    <span class="n">books</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">reading_list</span><span class="p">)</span>
</code></pre></div>

<p>我们需要了解的第二个函数是<code>json.dump</code>。这个函数需要一个字典或列表，以及一个要写入的文件。</p>
<p>当使用<code>dump</code>时，我们将以写模式(<code>"w"</code>)写入文件，这将截断文件。然后，我们将向包含图书馆中所有书籍的文件中写入一个新的JSON数组。</p>
<p>我们之所以要采用这种方法，是因为我们的文件中必须有一个顶级数组或对象来满足JSON规范，所以我们不能简单地向现有文件内容添加新对象。</p>
<p>别担心。虽然这看起来有些浪费，但是对于非常大量的数据来说，这将是一个近乎即时的操作。当性能成为一个问题时，我们可能已经转移到像数据库这样的存储上了。</p>
<p>下面是一个我们将如何使用<code>dump</code>函数的例子:</p>
<div class="codehilite"><pre><span/><code><span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s2">"books.json"</span><span class="p">,</span> <span class="s2">"w"</span><span class="p">)</span> <span class="k">as</span> <span class="n">reading_list</span><span class="p">:</span>
    <span class="n">json</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">books</span><span class="p">,</span> <span class="n">reading_list</span><span class="p">)</span>  <span class="c1"># books is the list of books we want to write</span>
</code></pre></div>

<h3>注意</h3>
<p>还有一个版本的<code>dump</code>和<code>load</code>叫做<code>dumps</code>和<code>loads</code>，但是它们做的事情不一样。</p>
<p>函数名中的“s”指的是字符串，因为这些函数要么接受JSON作为字符串，要么给我们一个我们已经转换成JSON的代码的字符串表示。你可以在<code>json</code>模块<a href="https://docs.python.org/3/library/json.html">文档</a>中找到大量的例子。</p>
<h2>案情摘要</h2>
<p>这个项目的起点将是我们在第14天写的代码。如果您还没有尝试过第14天项目的<a href="/30-days-of-python/python-30-day-14-project-hard/">更难版本</a>，我建议您在继续这里之前尝试一下，因为您将最终得到一个具有更令人印象深刻的功能的应用程序。</p>
<p>这个项目的任务相对简单。我们需要更新阅读列表应用程序的实现，以便我们的数据存储在一个名为<code>books.json</code>的新文件中。我们也将从这个新文件中检索我们所有的图书数据。</p>
<p>如果你正在为这个项目创建一个新的repl或workspace，没有必要跨<code>books.csv</code>复制，因为我们将不再使用它。</p>
<p>由于空文件不是有效的JSON，我建议创建带有空方括号的<code>books.json</code>文件。这是一个空的JSON数组，完全有效，我们可以用JSON对象填充这个JSON数组。每个对象代表一本不同的书，你可以把这个文件结构想象成一个字典列表。</p>
<p>在项目演练期间，我将向您展示一种以编程方式创建文件的方法，这样我们就不需要预先有一个<code>books.json</code>文件。明天我们将学习我们需要的工具，所以这不是你必须自己照顾自己的事情。</p>
<p>正如我在上面的JSON介绍中提到的，每当我们做出更改时，我们都必须完全替换<code>books.json</code>文件的内容，因为简单地添加新的JSON对象会很快导致文件不符合JSON规范。与其考虑这一点，不如简单地替换整个文件。</p>
<p>祝你好运！</p>
<h2>我们的解决方案</h2>
<p>我们的解决方案都在下面，或者你可以观看演练的<a href="https://youtu.be/83EMCbvJeJA">视频版本</a>。</p>
<p>我将从项目较难版本的代码开始，看起来像这样:</p>
<div class="codehilite"><pre><span/><code><span class="k">def</span> <span class="nf">add_book</span><span class="p">():</span>
    <span class="n">title</span> <span class="o">=</span> <span class="nb">input</span><span class="p">(</span><span class="s2">"Title: "</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">title</span><span class="p">()</span>
    <span class="n">author</span> <span class="o">=</span> <span class="nb">input</span><span class="p">(</span><span class="s2">"Author: "</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">title</span><span class="p">()</span>
    <span class="n">year</span> <span class="o">=</span> <span class="nb">input</span><span class="p">(</span><span class="s2">"Year of publication: "</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>

    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s2">"books.csv"</span><span class="p">,</span> <span class="s2">"a"</span><span class="p">)</span> <span class="k">as</span> <span class="n">reading_list</span><span class="p">:</span>
        <span class="n">reading_list</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="sa">f</span><span class="s2">"</span><span class="si">{</span><span class="n">title</span><span class="si">}</span><span class="s2">,</span><span class="si">{</span><span class="n">author</span><span class="si">}</span><span class="s2">,</span><span class="si">{</span><span class="n">year</span><span class="si">}</span><span class="s2">,Not Read</span><span class="se">\\\\</span><span class="s2">n"</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">delete_book</span><span class="p">(</span><span class="n">books</span><span class="p">,</span> <span class="n">book_to_delete</span><span class="p">):</span>
    <span class="n">books</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">book_to_delete</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">find_books</span><span class="p">():</span>
    <span class="n">reading_list</span> <span class="o">=</span> <span class="n">get_all_books</span><span class="p">()</span>
    <span class="n">matching_books</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="n">search_term</span> <span class="o">=</span> <span class="nb">input</span><span class="p">(</span><span class="s2">"Please enter a book title: "</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>

    <span class="k">for</span> <span class="n">book</span> <span class="ow">in</span> <span class="n">reading_list</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">search_term</span> <span class="ow">in</span> <span class="n">book</span><span class="p">[</span><span class="s2">"title"</span><span class="p">]</span><span class="o">.</span><span class="n">lower</span><span class="p">():</span>
            <span class="n">matching_books</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">book</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">matching_books</span>

<span class="c1"># Helper function for retrieving data from the csv file</span>
<span class="k">def</span> <span class="nf">get_all_books</span><span class="p">():</span>
    <span class="n">books</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s2">"books.csv"</span><span class="p">,</span> <span class="s2">"r"</span><span class="p">)</span> <span class="k">as</span> <span class="n">reading_list</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">book</span> <span class="ow">in</span> <span class="n">reading_list</span><span class="p">:</span>
            <span class="c1"># Extracts the values from the CSV data</span>
            <span class="n">title</span><span class="p">,</span> <span class="n">author</span><span class="p">,</span> <span class="n">year</span><span class="p">,</span> <span class="n">read_status</span> <span class="o">=</span> <span class="n">book</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">","</span><span class="p">)</span>

            <span class="c1"># Creates a dictionary from the csv data and adds it to the books list</span>
            <span class="n">books</span><span class="o">.</span><span class="n">append</span><span class="p">({</span>
                <span class="s2">"title"</span><span class="p">:</span> <span class="n">title</span><span class="p">,</span>
                <span class="s2">"author"</span><span class="p">:</span> <span class="n">author</span><span class="p">,</span>
                <span class="s2">"year"</span><span class="p">:</span> <span class="n">year</span><span class="p">,</span>
                <span class="s2">"read"</span><span class="p">:</span> <span class="n">read_status</span>
            <span class="p">})</span>

    <span class="k">return</span> <span class="n">books</span>

<span class="k">def</span> <span class="nf">mark_book_as_read</span><span class="p">(</span><span class="n">books</span><span class="p">,</span> <span class="n">book_to_update</span><span class="p">):</span>
    <span class="n">index</span> <span class="o">=</span> <span class="n">books</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">book_to_update</span><span class="p">)</span>
    <span class="n">books</span><span class="p">[</span><span class="n">index</span><span class="p">][</span><span class="s1">'read'</span><span class="p">]</span> <span class="o">=</span> <span class="s2">"Read"</span>

<span class="k">def</span> <span class="nf">update_reading_list</span><span class="p">(</span><span class="n">operation</span><span class="p">):</span>
    <span class="n">books</span> <span class="o">=</span> <span class="n">get_all_books</span><span class="p">()</span>
    <span class="n">matching_books</span> <span class="o">=</span> <span class="n">find_books</span><span class="p">()</span>

    <span class="k">if</span> <span class="n">matching_books</span><span class="p">:</span>
        <span class="n">operation</span><span class="p">(</span><span class="n">books</span><span class="p">,</span> <span class="n">matching_books</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>

        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s2">"books.csv"</span><span class="p">,</span> <span class="s2">"w"</span><span class="p">)</span> <span class="k">as</span> <span class="n">reading_list</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">book</span> <span class="ow">in</span> <span class="n">books</span><span class="p">:</span>
                <span class="n">reading_list</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="sa">f</span><span class="s2">"</span><span class="si">{</span><span class="n">book</span><span class="p">[</span><span class="s1">'title'</span><span class="p">]</span><span class="si">}</span><span class="s2">,</span><span class="si">{</span><span class="n">book</span><span class="p">[</span><span class="s1">'author'</span><span class="p">]</span><span class="si">}</span><span class="s2">,</span><span class="si">{</span><span class="n">book</span><span class="p">[</span><span class="s1">'year'</span><span class="p">]</span><span class="si">}</span><span class="s2">,</span><span class="si">{</span><span class="n">book</span><span class="p">[</span><span class="s1">'read'</span><span class="p">]</span><span class="si">}</span><span class="se">\\\\</span><span class="s2">n"</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">"Sorry, we didn't find any books matching that title."</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">show_books</span><span class="p">(</span><span class="n">books</span><span class="p">):</span>
    <span class="c1"># Adds an empty line before the output</span>
    <span class="nb">print</span><span class="p">()</span>

    <span class="k">for</span> <span class="n">book</span> <span class="ow">in</span> <span class="n">books</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"</span><span class="si">{</span><span class="n">book</span><span class="p">[</span><span class="s1">'title'</span><span class="p">]</span><span class="si">}</span><span class="s2">, by </span><span class="si">{</span><span class="n">book</span><span class="p">[</span><span class="s1">'author'</span><span class="p">]</span><span class="si">}</span><span class="s2"> (</span><span class="si">{</span><span class="n">book</span><span class="p">[</span><span class="s1">'year'</span><span class="p">]</span><span class="si">}</span><span class="s2">) - </span><span class="si">{</span><span class="n">book</span><span class="p">[</span><span class="s1">'read'</span><span class="p">]</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>

    <span class="nb">print</span><span class="p">()</span>

<span class="n">menu_prompt</span> <span class="o">=</span> <span class="s2">"""Please enter one of the following options:</span>

<span class="s2">- 'a' to add a book</span>
<span class="s2">- 'd' to delete a book</span>
<span class="s2">- 'l' to list the books</span>
<span class="s2">- 'r' to mark a book as read</span>
<span class="s2">- 's' to search for a book</span>
<span class="s2">- 'q' to quit</span>

<span class="s2">What would you like to do? """</span>

<span class="c1"># Get a selection from the user</span>
<span class="n">selected_option</span> <span class="o">=</span> <span class="nb">input</span><span class="p">(</span><span class="n">menu_prompt</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>

<span class="c1"># Run the loop until the user selected 'q'</span>
<span class="k">while</span> <span class="n">selected_option</span> <span class="o">!=</span> <span class="s2">"q"</span><span class="p">:</span>
    <span class="k">if</span> <span class="n">selected_option</span> <span class="o">==</span> <span class="s2">"a"</span><span class="p">:</span>
        <span class="n">add_book</span><span class="p">()</span>
    <span class="k">elif</span> <span class="n">selected_option</span> <span class="o">==</span> <span class="s2">"d"</span><span class="p">:</span>
        <span class="n">update_reading_list</span><span class="p">(</span><span class="n">delete_book</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">selected_option</span> <span class="o">==</span> <span class="s2">"l"</span><span class="p">:</span>
        <span class="c1"># Retrieves the whole reading list for printing</span>
        <span class="n">reading_list</span> <span class="o">=</span> <span class="n">get_all_books</span><span class="p">()</span>

        <span class="c1"># Check that reading_list contains at least one book</span>
        <span class="k">if</span> <span class="n">reading_list</span><span class="p">:</span>
            <span class="n">show_books</span><span class="p">(</span><span class="n">reading_list</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">"Your reading list is empty."</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">selected_option</span> <span class="o">==</span> <span class="s2">"r"</span><span class="p">:</span>
        <span class="n">update_reading_list</span><span class="p">(</span><span class="n">mark_book_as_read</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">selected_option</span> <span class="o">==</span> <span class="s2">"s"</span><span class="p">:</span>
        <span class="n">matching_books</span> <span class="o">=</span> <span class="n">find_books</span><span class="p">()</span>

        <span class="c1"># Checks that the seach returned at least one book</span>
        <span class="k">if</span> <span class="n">matching_books</span><span class="p">:</span>
            <span class="n">show_books</span><span class="p">(</span><span class="n">matching_books</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">"Sorry, we didn't find any books for that search term"</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Sorry, '</span><span class="si">{</span><span class="n">selected_option</span><span class="si">}</span><span class="s2">' isn't a valid option."</span><span class="p">)</span>

    <span class="c1"># Allow the user to change their selection at the end of each iteration</span>
    <span class="n">selected_option</span> <span class="o">=</span> <span class="nb">input</span><span class="p">(</span><span class="n">menu_prompt</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
</code></pre></div>

<p>这里有相当多的代码，但是不要着急浏览。如果你有任何理解上的困难，我建议你看看从第14天开始的项目演练。</p>
<p>这个程序的大部分将会完全相同。我们当前实施中需要更改的功能有:</p>
<ul>
<li><code>add_book</code></li>
<li><code>get_all_books</code></li>
<li><code>update_reading_list</code></li>
</ul>
<p>我们的其他函数都不处理这个文件，所以它们的实现将保持不变。我们的菜单代码也是如此，它与我们的存储方式无关。它简单地向用户呈现一个界面，并将功能委托给我们的函数。</p>
<p>让我们从在文件顶部导入<code>json</code>模块开始，因为我们将需要在几个地方使用它。</p>


<p>随着<code>json</code>的导入，我们可以开始修改<code>get_all_books</code>。这是一个很好的起点，因为我们在几个不同的地方依赖这个函数，并且我们在新的<code>add_book</code>实现中也需要它。</p>
<div class="codehilite"><pre><span/><code><span class="k">def</span> <span class="nf">get_all_books</span><span class="p">():</span>
    <span class="n">books</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s2">"books.csv"</span><span class="p">,</span> <span class="s2">"r"</span><span class="p">)</span> <span class="k">as</span> <span class="n">reading_list</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">book</span> <span class="ow">in</span> <span class="n">reading_list</span><span class="p">:</span>
            <span class="c1"># Extracts the values from the CSV data</span>
            <span class="n">title</span><span class="p">,</span> <span class="n">author</span><span class="p">,</span> <span class="n">year</span><span class="p">,</span> <span class="n">read_status</span> <span class="o">=</span> <span class="n">book</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">","</span><span class="p">)</span>

            <span class="c1"># Creates a dictionary from the csv data and adds it to the books list</span>
            <span class="n">books</span><span class="o">.</span><span class="n">append</span><span class="p">({</span>
                <span class="s2">"title"</span><span class="p">:</span> <span class="n">title</span><span class="p">,</span>
                <span class="s2">"author"</span><span class="p">:</span> <span class="n">author</span><span class="p">,</span>
                <span class="s2">"year"</span><span class="p">:</span> <span class="n">year</span><span class="p">,</span>
                <span class="s2">"read"</span><span class="p">:</span> <span class="n">read_status</span>
            <span class="p">})</span>

    <span class="k">return</span> <span class="n">books</span>
</code></pre></div>

<p>此刻，我们阅读我们的旧文件；我们处理文件的每一行；构建字典；并将其添加到<code>books</code>列表中。然后，我们返回这个字典列表，供应用程序中的其他地方使用。</p>
<p>我们的新实现实际上要简单得多，因为我们不再需要自己处理任何数据。<code>json.load</code>函数将能够看到我们有一个JSON数组，可能填充了JSON对象，它将返回给我们一个对应于该数据的字典列表。</p>
<div class="codehilite"><pre><span/><code><span class="k">def</span> <span class="nf">get_all_books</span><span class="p">():</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s2">"books.json"</span><span class="p">,</span> <span class="s2">"r"</span><span class="p">)</span> <span class="k">as</span> <span class="n">reading_list</span><span class="p">:</span>
        <span class="n">books</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">reading_list</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">books</span>
</code></pre></div>

<p>这展示了使用其他模块的强大功能。解析JSON并不是一项非常简单的任务，这里我们只用一行代码就完成了。</p>
<p>作为参考，还有一个<code>csv</code>模块可以让我们在处理CSV数据时做一些非常类似的事情。我们有一个简短的视频介绍如何使用这个<a href="https://www.youtube.com/watch?v=W7QByFjVom8">在这里</a>。</p>
<p>我们还可以使我们的<code>get_all_books</code>函数更短，因为我们并不真正需要这个<code>books</code>变量。我们可以从上下文管理器中返回字典列表。</p>
<div class="codehilite"><pre><span/><code><span class="k">def</span> <span class="nf">get_all_books</span><span class="p">():</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s2">"books.json"</span><span class="p">,</span> <span class="s2">"r"</span><span class="p">)</span> <span class="k">as</span> <span class="n">reading_list</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">json</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">reading_list</span><span class="p">)</span>
</code></pre></div>

<p>现在让我们转向<code>add_book</code>。这个函数将会看到一些相当重要的变化，因为我们不能再在文件中多写一行了。我们需要首先获得当前文件的内容，添加一个额外的记录，然后将新的内容写回到文件中。</p>
<p>幸运的是，我们已经有了一个获取文件内容的函数:最新更新的<code>get_all_books</code>函数。姑且称之为<code>add_book</code>的顶部吧。然后我们可以直接把原始的提示放在后面，因为我们仍然需要它们。</p>
<div class="codehilite"><pre><span/><code><span class="k">def</span> <span class="nf">add_book</span><span class="p">():</span>
    <span class="n">books</span> <span class="o">=</span> <span class="n">get_all_books</span><span class="p">()</span>

    <span class="n">title</span> <span class="o">=</span> <span class="nb">input</span><span class="p">(</span><span class="s2">"Title: "</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">title</span><span class="p">()</span>
    <span class="n">author</span> <span class="o">=</span> <span class="nb">input</span><span class="p">(</span><span class="s2">"Author: "</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">title</span><span class="p">()</span>
    <span class="n">year</span> <span class="o">=</span> <span class="nb">input</span><span class="p">(</span><span class="s2">"Year of publication: "</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
</code></pre></div>

<p>我们的下一步是构建一个字典，我们可以将它插入到我们的<code>books</code>列表中。我们可以这样创建它，作为调用<code>append</code>方法的一部分:</p>
<div class="codehilite"><pre><span/><code><span class="k">def</span> <span class="nf">add_book</span><span class="p">():</span>
    <span class="n">books</span> <span class="o">=</span> <span class="n">get_all_books</span><span class="p">()</span>

    <span class="n">title</span> <span class="o">=</span> <span class="nb">input</span><span class="p">(</span><span class="s2">"Title: "</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">title</span><span class="p">()</span>
    <span class="n">author</span> <span class="o">=</span> <span class="nb">input</span><span class="p">(</span><span class="s2">"Author: "</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">title</span><span class="p">()</span>
    <span class="n">year</span> <span class="o">=</span> <span class="nb">input</span><span class="p">(</span><span class="s2">"Year of publication: "</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>

    <span class="n">books</span><span class="o">.</span><span class="n">append</span><span class="p">({</span>
        <span class="s2">"title"</span><span class="p">:</span> <span class="n">title</span><span class="p">,</span>
        <span class="s2">"author"</span><span class="p">:</span> <span class="n">author</span><span class="p">,</span>
        <span class="s2">"year"</span><span class="p">:</span> <span class="n">year</span><span class="p">,</span>
        <span class="s2">"read"</span><span class="p">:</span> <span class="s2">"Not read"</span>
    <span class="p">})</span>
</code></pre></div>

<p>现在我们在<code>books</code>列表中有了新记录，我们可以将整个<code>books</code>列表写入JSON文件。通过以写模式打开文件，我们可以截断原始文件内容，并用新数据完全替换它。</p>
<p>为了写入数据，我们将使用<code>json.dump</code>。</p>
<div class="codehilite"><pre><span/><code><span class="k">def</span> <span class="nf">add_book</span><span class="p">():</span>
    <span class="n">books</span> <span class="o">=</span> <span class="n">get_all_books</span><span class="p">()</span>

    <span class="n">title</span> <span class="o">=</span> <span class="nb">input</span><span class="p">(</span><span class="s2">"Title: "</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">title</span><span class="p">()</span>
    <span class="n">author</span> <span class="o">=</span> <span class="nb">input</span><span class="p">(</span><span class="s2">"Author: "</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">title</span><span class="p">()</span>
    <span class="n">year</span> <span class="o">=</span> <span class="nb">input</span><span class="p">(</span><span class="s2">"Year of publication: "</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>

    <span class="n">books</span><span class="o">.</span><span class="n">append</span><span class="p">({</span>
        <span class="s2">"title"</span><span class="p">:</span> <span class="n">title</span><span class="p">,</span>
        <span class="s2">"author"</span><span class="p">:</span> <span class="n">author</span><span class="p">,</span>
        <span class="s2">"year"</span><span class="p">:</span> <span class="n">year</span><span class="p">,</span>
        <span class="s2">"read"</span><span class="p">:</span> <span class="s2">"Not read"</span>
    <span class="p">})</span>

    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s2">"books.json"</span><span class="p">,</span> <span class="s2">"w"</span><span class="p">)</span> <span class="k">as</span> <span class="n">reading_list</span><span class="p">:</span>
        <span class="n">json</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">books</span><span class="p">,</span> <span class="n">reading_list</span><span class="p">)</span>
</code></pre></div>

<p>现在我们可以进行最后的修改了:函数<code>update_reading_list</code>。</p>
<div class="codehilite"><pre><span/><code><span class="k">def</span> <span class="nf">update_reading_list</span><span class="p">(</span><span class="n">operation</span><span class="p">):</span>
    <span class="n">books</span> <span class="o">=</span> <span class="n">get_all_books</span><span class="p">()</span>
    <span class="n">matching_books</span> <span class="o">=</span> <span class="n">find_books</span><span class="p">()</span>

    <span class="k">if</span> <span class="n">matching_books</span><span class="p">:</span>
        <span class="n">operation</span><span class="p">(</span><span class="n">books</span><span class="p">,</span> <span class="n">matching_books</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>

        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s2">"books.csv"</span><span class="p">,</span> <span class="s2">"w"</span><span class="p">)</span> <span class="k">as</span> <span class="n">reading_list</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">book</span> <span class="ow">in</span> <span class="n">books</span><span class="p">:</span>
                <span class="n">reading_list</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="sa">f</span><span class="s2">"</span><span class="si">{</span><span class="n">book</span><span class="p">[</span><span class="s1">'title'</span><span class="p">]</span><span class="si">}</span><span class="s2">,</span><span class="si">{</span><span class="n">book</span><span class="p">[</span><span class="s1">'author'</span><span class="p">]</span><span class="si">}</span><span class="s2">,</span><span class="si">{</span><span class="n">book</span><span class="p">[</span><span class="s1">'year'</span><span class="p">]</span><span class="si">}</span><span class="s2">,</span><span class="si">{</span><span class="n">book</span><span class="p">[</span><span class="s1">'read'</span><span class="p">]</span><span class="si">}</span><span class="se">\\\\</span><span class="s2">n"</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">"Sorry, we didn't find any books matching that title."</span><span class="p">)</span>
</code></pre></div>

<p>在这里，我们实际上能够进行另一种简化，因为我们不再需要手动格式化我们写入文件的内容。我们只要用<code>dump</code>把<code>books</code>列表翻译成JSON就够了。</p>
<div class="codehilite"><pre><span/><code><span class="k">def</span> <span class="nf">update_reading_list</span><span class="p">(</span><span class="n">operation</span><span class="p">):</span>
    <span class="n">books</span> <span class="o">=</span> <span class="n">get_all_books</span><span class="p">()</span>
    <span class="n">matching_books</span> <span class="o">=</span> <span class="n">find_books</span><span class="p">()</span>

    <span class="k">if</span> <span class="n">matching_books</span><span class="p">:</span>
        <span class="n">operation</span><span class="p">(</span><span class="n">books</span><span class="p">,</span> <span class="n">matching_books</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>

        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s2">"books.json"</span><span class="p">,</span> <span class="s2">"w"</span><span class="p">)</span> <span class="k">as</span> <span class="n">reading_list</span><span class="p">:</span>
            <span class="n">json</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">books</span><span class="p">,</span> <span class="n">reading_list</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">"Sorry, we didn't find any books matching that title."</span><span class="p">)</span>
</code></pre></div>

<p>至此，我们已经完成了所有需要的更改，但是我们还可以做一些其他的事情。</p>
<p>首先，我们可以使用新的<code>**</code>解包语法来缩短我们的<code>show_books</code>函数。目前我们有这个:</p>
<div class="codehilite"><pre><span/><code><span class="k">def</span> <span class="nf">show_books</span><span class="p">(</span><span class="n">books</span><span class="p">):</span>
    <span class="c1"># Adds an empty line before the output</span>
    <span class="nb">print</span><span class="p">()</span>

    <span class="k">for</span> <span class="n">book</span> <span class="ow">in</span> <span class="n">books</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"</span><span class="si">{</span><span class="n">book</span><span class="p">[</span><span class="s1">'title'</span><span class="p">]</span><span class="si">}</span><span class="s2">, by </span><span class="si">{</span><span class="n">book</span><span class="p">[</span><span class="s1">'author'</span><span class="p">]</span><span class="si">}</span><span class="s2"> (</span><span class="si">{</span><span class="n">book</span><span class="p">[</span><span class="s1">'year'</span><span class="p">]</span><span class="si">}</span><span class="s2">) - </span><span class="si">{</span><span class="n">book</span><span class="p">[</span><span class="s1">'read'</span><span class="p">]</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>

    <span class="nb">print</span><span class="p">()</span>
</code></pre></div>

<p>为这里的每一个值都编写一个订阅表达式有点冗长，实际上我们有几个备选方案。</p>
<p>首先，我们可以将<code>book</code>分解成几个变量，并像这样使用它们:</p>
<div class="codehilite"><pre><span/><code><span class="k">def</span> <span class="nf">show_books</span><span class="p">(</span><span class="n">books</span><span class="p">):</span>
    <span class="c1"># Adds an empty line before the output</span>
    <span class="nb">print</span><span class="p">()</span>

    <span class="k">for</span> <span class="n">book</span> <span class="ow">in</span> <span class="n">books</span><span class="p">:</span>
        <span class="n">title</span><span class="p">,</span> <span class="n">author</span><span class="p">,</span> <span class="n">year</span><span class="p">,</span> <span class="n">read</span> <span class="o">=</span> <span class="n">book</span><span class="o">.</span><span class="n">values</span><span class="p">()</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"</span><span class="si">{</span><span class="n">title</span><span class="si">}</span><span class="s2">, by </span><span class="si">{</span><span class="n">author</span><span class="si">}</span><span class="s2"> (</span><span class="si">{</span><span class="n">year</span><span class="si">}</span><span class="s2">) - </span><span class="si">{</span><span class="n">read</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>

    <span class="nb">print</span><span class="p">()</span>
</code></pre></div>

<p>这很好，但是我们可以通过使用带有<code>format</code>的命名占位符来避免预先定义所有这些变量。如果你需要复习，我们在<a href="/30-days-of-python/python-30-day-3-string-formatting/">第三天</a>已经讨论过了。</p>
<p>请记住，使用<code>**</code>解包字典会给我们一系列关键字参数，这正是我们使用<code>format</code>给命名占位符赋值的方式。因此，我们可以这样做:</p>
<div class="codehilite"><pre><span/><code><span class="k">def</span> <span class="nf">show_books</span><span class="p">(</span><span class="n">books</span><span class="p">):</span>
    <span class="c1"># Adds an empty line before the output</span>
    <span class="nb">print</span><span class="p">()</span>

    <span class="k">for</span> <span class="n">book</span> <span class="ow">in</span> <span class="n">books</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">"</span><span class="si">{title}</span><span class="s2">, by </span><span class="si">{author}</span><span class="s2"> (</span><span class="si">{year}</span><span class="s2">) - </span><span class="si">{read}</span><span class="s2">"</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="o">**</span><span class="n">book</span><span class="p">))</span>

    <span class="nb">print</span><span class="p">()</span>
</code></pre></div>

<p>升级代码的另一个方法是进行某种检查，以确保文件存在。这有点超前于明天的内容，但是应该很容易理解。</p>
<p>我们将创建一个这样的函数:</p>
<div class="codehilite"><pre><span/><code><span class="k">def</span> <span class="nf">create_book_file</span><span class="p">():</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s2">"books.json"</span><span class="p">,</span> <span class="s2">"x"</span><span class="p">)</span> <span class="k">as</span> <span class="n">reading_list</span><span class="p">:</span>
            <span class="n">json</span><span class="o">.</span><span class="n">dump</span><span class="p">([],</span> <span class="n">reading_list</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">FileExistsError</span><span class="p">:</span>
        <span class="k">pass</span>
</code></pre></div>

<p>这里我们说Python应该尝试使用<code>"x"</code>模式创建一个名为<code>books.json</code>的文件，这意味着独占创建。如果这个文件已经存在，<code>open</code>将引发一个名为<code>FileExistsError</code>的特殊异常。使用一个<code>except</code>子句，我们告诉Python监听这个错误，如果它在运行上面的代码时遇到这个错误，它应该忽略它。</p>
<p>现在我们只需在开始程序时调用<code>create_book_file</code>。</p>
<p>就这样，我们结束了！完整的代码可以在下面找到:</p>
<div class="codehilite"><pre><span/><code><span class="kn">import</span> <span class="nn">json</span>

<span class="k">def</span> <span class="nf">add_book</span><span class="p">():</span>
    <span class="n">books</span> <span class="o">=</span> <span class="n">get_all_books</span><span class="p">()</span>

    <span class="n">title</span> <span class="o">=</span> <span class="nb">input</span><span class="p">(</span><span class="s2">"Title: "</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">title</span><span class="p">()</span>
    <span class="n">author</span> <span class="o">=</span> <span class="nb">input</span><span class="p">(</span><span class="s2">"Author: "</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">title</span><span class="p">()</span>
    <span class="n">year</span> <span class="o">=</span> <span class="nb">input</span><span class="p">(</span><span class="s2">"Year of publication: "</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>

    <span class="n">books</span><span class="o">.</span><span class="n">append</span><span class="p">({</span>
        <span class="s2">"title"</span><span class="p">:</span> <span class="n">title</span><span class="p">,</span>
        <span class="s2">"author"</span><span class="p">:</span> <span class="n">author</span><span class="p">,</span>
        <span class="s2">"year"</span><span class="p">:</span> <span class="n">year</span><span class="p">,</span>
        <span class="s2">"read"</span><span class="p">:</span> <span class="s2">"Not read"</span>
    <span class="p">})</span>

    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s2">"books.json"</span><span class="p">,</span> <span class="s2">"w"</span><span class="p">)</span> <span class="k">as</span> <span class="n">reading_list</span><span class="p">:</span>
        <span class="n">json</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">books</span><span class="p">,</span> <span class="n">reading_list</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">create_book_file</span><span class="p">():</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s2">"books.json"</span><span class="p">,</span> <span class="s2">"x"</span><span class="p">)</span> <span class="k">as</span> <span class="n">reading_list</span><span class="p">:</span>
            <span class="n">json</span><span class="o">.</span><span class="n">dump</span><span class="p">([],</span> <span class="n">reading_list</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">FileExistsError</span><span class="p">:</span>
        <span class="k">pass</span>

<span class="k">def</span> <span class="nf">delete_book</span><span class="p">(</span><span class="n">books</span><span class="p">,</span> <span class="n">book_to_delete</span><span class="p">):</span>
    <span class="n">books</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">book_to_delete</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">find_books</span><span class="p">():</span>
    <span class="n">reading_list</span> <span class="o">=</span> <span class="n">get_all_books</span><span class="p">()</span>
    <span class="n">matching_books</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="n">search_term</span> <span class="o">=</span> <span class="nb">input</span><span class="p">(</span><span class="s2">"Please enter a book title: "</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>

    <span class="k">for</span> <span class="n">book</span> <span class="ow">in</span> <span class="n">reading_list</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">search_term</span> <span class="ow">in</span> <span class="n">book</span><span class="p">[</span><span class="s2">"title"</span><span class="p">]</span><span class="o">.</span><span class="n">lower</span><span class="p">():</span>
            <span class="n">matching_books</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">book</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">matching_books</span>

<span class="c1"># Helper function for retrieving data from the csv file</span>
<span class="k">def</span> <span class="nf">get_all_books</span><span class="p">():</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s2">"books.json"</span><span class="p">,</span> <span class="s2">"r"</span><span class="p">)</span> <span class="k">as</span> <span class="n">reading_list</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">json</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">reading_list</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">mark_book_as_read</span><span class="p">(</span><span class="n">books</span><span class="p">,</span> <span class="n">book_to_update</span><span class="p">):</span>
    <span class="n">index</span> <span class="o">=</span> <span class="n">books</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">book_to_update</span><span class="p">)</span>
    <span class="n">books</span><span class="p">[</span><span class="n">index</span><span class="p">][</span><span class="s1">'read'</span><span class="p">]</span> <span class="o">=</span> <span class="s2">"Read"</span>

<span class="k">def</span> <span class="nf">update_reading_list</span><span class="p">(</span><span class="n">operation</span><span class="p">):</span>
    <span class="n">books</span> <span class="o">=</span> <span class="n">get_all_books</span><span class="p">()</span>
    <span class="n">matching_books</span> <span class="o">=</span> <span class="n">find_books</span><span class="p">()</span>

    <span class="k">if</span> <span class="n">matching_books</span><span class="p">:</span>
        <span class="n">operation</span><span class="p">(</span><span class="n">books</span><span class="p">,</span> <span class="n">matching_books</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>

        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s2">"books.json"</span><span class="p">,</span> <span class="s2">"w"</span><span class="p">)</span> <span class="k">as</span> <span class="n">reading_list</span><span class="p">:</span>
            <span class="n">json</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">books</span><span class="p">,</span> <span class="n">reading_list</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">"Sorry, we didn't find any books matching that title."</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">show_books</span><span class="p">(</span><span class="n">books</span><span class="p">):</span>
    <span class="c1"># Adds an empty line before the output</span>
    <span class="nb">print</span><span class="p">()</span>

    <span class="k">for</span> <span class="n">book</span> <span class="ow">in</span> <span class="n">books</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">"</span><span class="si">{title}</span><span class="s2">, by </span><span class="si">{author}</span><span class="s2"> (</span><span class="si">{year}</span><span class="s2">) - </span><span class="si">{read}</span><span class="s2">"</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="o">**</span><span class="n">book</span><span class="p">))</span>

    <span class="nb">print</span><span class="p">()</span>

<span class="n">create_book_file</span><span class="p">()</span>

<span class="n">menu_prompt</span> <span class="o">=</span> <span class="s2">"""Please enter one of the following options:</span>

<span class="s2">- 'a' to add a book</span>
<span class="s2">- 'd' to delete a book</span>
<span class="s2">- 'l' to list the books</span>
<span class="s2">- 'r' to mark a book as read</span>
<span class="s2">- 's' to search for a book</span>
<span class="s2">- 'q' to quit</span>

<span class="s2">What would you like to do? """</span>

<span class="c1"># Get a selection from the user</span>
<span class="n">selected_option</span> <span class="o">=</span> <span class="nb">input</span><span class="p">(</span><span class="n">menu_prompt</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>

<span class="c1"># Run the loop until the user selected 'q'</span>
<span class="k">while</span> <span class="n">selected_option</span> <span class="o">!=</span> <span class="s2">"q"</span><span class="p">:</span>
    <span class="k">if</span> <span class="n">selected_option</span> <span class="o">==</span> <span class="s2">"a"</span><span class="p">:</span>
        <span class="n">add_book</span><span class="p">()</span>
    <span class="k">elif</span> <span class="n">selected_option</span> <span class="o">==</span> <span class="s2">"d"</span><span class="p">:</span>
        <span class="n">update_reading_list</span><span class="p">(</span><span class="n">delete_book</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">selected_option</span> <span class="o">==</span> <span class="s2">"l"</span><span class="p">:</span>
        <span class="c1"># Retrieves the whole reading list for printing</span>
        <span class="n">reading_list</span> <span class="o">=</span> <span class="n">get_all_books</span><span class="p">()</span>

        <span class="c1"># Check that reading_list contains at least one book</span>
        <span class="k">if</span> <span class="n">reading_list</span><span class="p">:</span>
            <span class="n">show_books</span><span class="p">(</span><span class="n">reading_list</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">"Your reading list is empty."</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">selected_option</span> <span class="o">==</span> <span class="s2">"r"</span><span class="p">:</span>
        <span class="n">update_reading_list</span><span class="p">(</span><span class="n">mark_book_as_read</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">selected_option</span> <span class="o">==</span> <span class="s2">"s"</span><span class="p">:</span>
        <span class="n">matching_books</span> <span class="o">=</span> <span class="n">find_books</span><span class="p">()</span>

        <span class="c1"># Checks that the seach returned at least one book</span>
        <span class="k">if</span> <span class="n">matching_books</span><span class="p">:</span>
            <span class="n">show_books</span><span class="p">(</span><span class="n">matching_books</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">"Sorry, we didn't find any books for that search term"</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Sorry, '</span><span class="si">{</span><span class="n">selected_option</span><span class="si">}</span><span class="s2">' isn't a valid option."</span><span class="p">)</span>

    <span class="c1"># Allow the user to change their selection at the end of each iteration</span>
    <span class="n">selected_option</span> <span class="o">=</span> <span class="nb">input</span><span class="p">(</span><span class="n">menu_prompt</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
</code></pre></div>

<p>和往常一样，我鼓励你继续做这个项目，看看你能如何改进它。这可能意味着添加更多的功能，使代码更简单，或者使现有的功能更健壮。</p>
<p>看看你能发现什么。编码快乐！</p> 
                </article>
            
            </div>    
</body>
</html>