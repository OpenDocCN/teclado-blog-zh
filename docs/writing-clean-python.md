# 编写干净的 Python

> 原文：<https://blog.teclado.com/writing-clean-python/>

在这篇文章中，我们将暂时停止展示 Python 的特性，转而关注如何写好 Python*。Python 语言是在考虑可读性的情况下创建的，所以我们真的应该尽我们所能来开发这种潜力。结果是我们的应用程序中有非常漂亮的代码。*

## *代码是给人类的*

*我认为我们在编程时很容易忘记的一件事是，代码是给人类的，而不是给计算机的。像 Python 这样的语言是一个抽象层，因此我们作为开发人员不必使用计算机能够理解的低级指令。*

*当我们写 Python 代码时，它真的不是给计算机看的，而是给你和其他开发者看的。*

*那么，为什么许多人写的代码让人难以理解呢？*

*这有点像写一个儿童故事，使用在学术话语中可能看起来合适的单词和语法结构。材料和目标受众之间存在明显的脱节。*

*考虑到这一点，让我们看看如何编写好的、人性化的、漂亮的 Python 代码。*

## *编程风格*

*任何关于编写好代码的讨论最终都会涉及到代码风格的话题，所以让我们从一开始就解决这个问题。*

*Python 有一个官方的风格指南，在 Python 增强提案(PEP)中有详细说明，称为 [PEP8](https://www.python.org/dev/peps/pep-0008/) 。如果你有受虐狂的感觉，你可以通读整本书，但是我想把重点放在一些我经常看到的常见问题上。*

### *名称*

*名字是一个我们稍后会回来讨论的话题，但是在这里我只想说几句关于 Python 中名字的格式。*

*虽然像 JavaScript 这样的语言非常喜欢 camel case，它使用大写字母来标记较长名称中的新单词(例如`myVariableName`)，但 Python 的样式指南规定使用一种叫做 snake case 的东西，*

*Snake case 名称完全是小写的，多单词名称使用下划线分隔。比如`my_variable_name`。这种模式用于变量、函数、方法等。*

*这种命名模式有两个主要的例外:类和常量。*

*类使用了一种叫做 Pascal case 的东西，它和 camel case 一样，除了我们还使用了一个大写字母。一个例子可能是`MyClassName`。这个首字母大写是 Python 中一个很好的指示器，表明某个东西是一个类。*

*常量使用大写字母，单词用下划线分隔。基本上就是大写字母蛇案:`MY_CONSTANT`。*

*在您的代码中遵循这些命名模式是一个好主意，因为经验丰富的 Python 开发人员能够根据变量的命名方式来判断变量是什么。误用这些命名风格可能会使你很难一眼就明白你的代码是如何工作的。*

### *刻痕*

*Python 中的缩进非常重要，因为这是我们定义相关代码块的方式。许多其他语言会为此使用像花括号这样的东西，缩进更多的是一种可选的视觉辅助。*

*因为它具有语义意义，所以我们需要额外注意我们在 Python 中的缩进，首先这样我们就不会遇到错误，但也这样其他开发人员就可以非常容易地理解我们代码的层次结构。*

*Python 建议每一级缩进使用四个空格。最终，空格的数量并不重要:重要的是你的一致性。*

*但是，值得记住的是，非常小和非常大的缩进尺寸都有一些缺点。一两个空格缩进对人们来说可能很难解析，特别是对于有阅读障碍的开发人员。非常宽的缩进块，比如八个空格，显然更容易被发现，但是行长度变成了一个非常有限的因素。*

*我建议在这一点上坚持风格指南，但只是要确保你是一致的。*

### *空行和其他空白*

*我在我们学生的代码中看到的一个大问题是，特别是许多新开发人员非常关心编写简短的代码。他们不想添加任何空行，因为这会使他们的代码“更长”，他们避免在代码行中不需要的地方添加空格。*

*不要害怕在代码中使用空格。想想如果你用英语写作。我们把大块的文本分成段落，这样更容易阅读。我们可以在代码中做同样的事情。如果我们有一个相关的功能块，我们可以通过在它周围放置空行来使它成为一个单一的视觉单元。*

*例如，我喜欢在像 for 循环这样的东西周围留出空间，因为它们通常是非常独立的。*

*当涉及到代码行中的空格时，作为一般规则，您希望在所有二元操作符周围放置空格，包括赋值操作符，以及在逗号和冒号之后。*

*考虑以下两个列表:*

```
*`good = [1243.45, 344535.3, 4465.0043, 4775.393, 565.3]
bad = [1243.45,344535.3,4465.0043,4775.393,565.3]`* 
```

 *我认为这个例子不言自明。与第二个列表相比，阅读第一个列表并确定其内容信息显然要容易得多。

风格指南中的另一个好建议是在函数和类定义后放两行空行。因为这些块通常包含空行，所以双空行使得识别类或函数定义的结束位置变得非常容易。

### 保持行短

回到新开发人员经常试图编写非常短的代码的想法，一个常见的副作用是非常长的代码行。这很糟糕，原因有几个。

第一个完全是由于硬件的限制。屏幕只有这么宽，所以如果你真的走极端，把代码放在一行，你不可避免地会引入水平滚动。这意味着你的代码的读者不能一次读完所有的逻辑，他们必须前后滑动手指来解析你的代码。当然，您可以启用文本换行，但是为什么不将代码放在两行上呢？至少这样你就有了一个逻辑断点，而不是根据读者显示器的大小来分割代码。

第二个问题是人类自身的局限性。我们发现快速阅读一长串文本非常困难，这有几个很好的原因。

非常快的读者在几个单词块，甚至整行中工作，但是我们的周边视觉仅仅如此好。随着行长度的增加，阅读行所需的眼球运动增加，这降低了阅读速度。

眼睛移动得越多，人们就越容易搞不清正在读的是哪一行。这就导致了对同一材料的大量重读。

杂志和报纸等较大的印刷格式将文本分成几栏有一个很好的理由:这样我们更容易阅读信息。这也是为什么许多网站在网站内容的两边都有很大的空白，因为主要内容被限制在一个舒适的阅读宽度。

长代码行的最后一个主要问题是代码的复杂性。这些线不会无缘无故地变长:更多的东西被放在这些线上，这就是为什么它们变长了。这不可避免地会导致更密集的逻辑，而这对于人类读者来说又要困难得多。

复杂的逻辑很快就变得难以推理，所以抵制在代码中把许多操作连在一起的诱惑是非常重要的。如果用非常清晰易懂的方式多写了五行，那就值得了。

### 自动格式化

即使是我们中最优秀的人有时也会偏离好的实践，所以利用工具在事后自动格式化我们的代码是一个好主意。

你可能想要检查的一个工具是[黑色](https://pypi.org/project/black/)。它使用了 PEP8 的一种有点自由的解释，特别是当涉及到像线路长度这样的事情时。PEP8 规定了非常严格的最大行长度，但这有时会导致代码可读性较差，尤其是当我们因为超出限制一个字符而将代码拆分到多行时。

### 关于 PEP8 的最后一句话

正如我刚才提到的，有些时候严格遵守 PEP8 并不总是最好的事情。这是以良好风格编写代码的一个很好的经验法则，但是知道什么时候*而不是*遵循 PEP8 也很有用。

不要像对待 10 条戒律一样对待 PEP8，但是在你违反规则之前，要确保你知道你为什么要违反规则。

## 使用好名字

我经常在我们的课程上对学生说，变量名称基本上只是建立在文档中；不利用这一点完全是浪费。像`x`或`list_1`这样的变量名正在放弃一个描述与这些变量相关的值的黄金机会。

选择一个好名字很难，这绝对是一项你需要培养的技能，但是值得你花力气去学习。

举以下例子:

```
list_1 = ["John", "Rolf", "Sarah", "Anne"]

for e in list_1:
    print(e) 
```

这是相当简单的代码，但即使在这里，我们也可以通过使用好的名称来使 for 循环的作用更加明显:

```
friends = ["John", "Rolf", "Sarah", "Anne"]

for friend in friends:
    print(friend) 
```

更明确的版本可能是这样的:

```
friends = ["John", "Rolf", "Sarah", "Anne"]

for friend_name in friends:
    print(friend_name) 
```

现在想象一下，当逻辑实际上很复杂时，这会产生多大的差异。

关于名字，最后要记住的一点是单数和复数的用法。像`number`这样的名字向读者表明这可能是单个值，而像`numbers`这样的名字表明某个东西是一个集合。

一般来说，尽量为集合保留复数名称，但要确保在适当的时候使用它们。

## Pythonic 循环

我们已经在上面看到了一个很好的 for 循环的例子，但是许多人以非常不同的方式编写他们的 Python 循环。这样的模式很常见:

```
friends = ["John", "Rolf", "Sarah", "Anne"]

for i in range(len(friends)):
    print(friends[i]) 
```

上面的代码在功能上与此完全相同:

```
friends = ["John", "Rolf", "Sarah", "Anne"]

for friend_name in friends:
    print(friend_name) 
```

第一个例子来自对 Python 的 for 循环如何工作的误解。Python 使用“for each”风格的循环，我们可以直接访问 iterable 中的元素。然而，许多语言使用更传统的 for 循环，在这里创建一个计数器和一些停止条件，并且可以使用它通过索引访问集合中的项。

“for each”循环的好处是，我们可以使用好的、描述性的名称，而不必使用索引。一般来说，如果你在 Python 中引用类似循环的索引，可能有更好的方法。

那么，有哪些更好的方法呢？

### 使用`zip`

我在 Python 中看到索引的一个常见地方是当有人试图同时处理两个或更多的可迭代对象时。例如，也许我们有一个名字列表，我们有一个相应的年龄列表，我们想使用同一个循环打印出来。

一个简单的方法可能是这样的:

```
names = ["John", "Rolf", "Sarah", "Anne"]
ages = [27, 42, 31, 29]

for i in range(len(names)):
    print(f"{names[i]} is {ages[i]} years old.") 
```

明确地说，这段代码运行得非常好。然而，我认为如果逻辑更复杂，这种类型的方法将很快变得很难阅读。

我们可以使用`zip`函数使这段代码更加简洁。我们已经在发表了一篇关于这个功能的[博文，所以请查看以了解更多。你也可以查看](https://blog.teclado.com/python-zip/)[文档](https://docs.python.org/3/library/functions.html#zip)。

使用`zip`,上面的代码现在看起来像这样:

```
names = ["John", "Rolf", "Sarah", "Anne"]
ages = [27, 42, 31, 29]

for name, age in zip(names, ages):
    print(f"{name} is {age} years old.") 
```

### 使用`enumerate`

循环中索引的一个不太常见但仍相当常见的用法是，当有人需要某种计数器时，他们认为可以先生成这个计数器，然后将它用作索引，这样可以一举两得。

大概是这样的:

```
names = ["John", "Rolf", "Sarah", "Anne"]

for i in range(len(names)):
    print(f"Person {i + 1} is called {names[i]}") 
```

虽然这段代码功能完善，但我们可以通过使用`enumerate`函数让事情变得更简洁。再说一次，我们已经在`enumerate`上发布了一个帖子，所以你[应该查看一下，以了解更多信息](https://blog.teclado.com/python-enumerate/)。你也可以看看[文档](https://docs.python.org/3/library/functions.html#enumerate)。

使用`enumerate`上面的代码看起来像这样:

```
names = ["John", "Rolf", "Sarah", "Anne"]

for counter, name in enumerate(names, start=1):
    print(f"Person {counter} is called {name}") 
```

## 解构

上面的两个例子都使用了一种叫做析构的技术，我们[也有一篇关于](https://blog.teclado.com/destructuring-in-python/)的博文，但是我想谈谈析构非常有用的另一种情况。

在我们的[完整 Python 课程](https://www.udemy.com/course/the-complete-python-course/)中，我们有一个练习，让学生创建一个测验系统，他们有一个包含问题和答案的文件。他们需要将文件的每一行拆分成问题和答案，每一行看起来像这样:`3+8=11`。

许多学生沿着这些路线追求一些东西:

```
for line in question_file:
    question = line.split("=")[0]
    answer = line.split("=")[1] 
```

然而，这是另一个消除索引的绝佳机会，而析构是我们选择的武器:

```
for line in question_file:
    question, answer = line.split("=") 
```

这种技术可以在任何时候使用，当我们处理一些有序的集合，并且我们想把它分割成组成部分的时候。这是非常值得熟悉的，它会使你的代码更加整洁。

## 惯用条件句

我觉得 Python 中的条件句就像是一种书呆子气，它能很快识别出你是某个通常使用另一种语言的人。

这样的代码很常见:

```
if len(some_list) != 0:
    ... do something 
```

或者:

```
if some_string != "":
    ... do something 
```

这当然是非常显式的代码，我不认为它有什么问题，*本身*，但是它不是很习惯:大多数有经验的 Python 开发人员不会这样写。相反，依赖某些类型的真值是很常见的。

在 Python 中，很少有东西评估为`False`，但是空集合是其中之一。这意味着字符串、集合、元组、字典、列表等。

因此，我们可以这样写，而不是写上面的例子:

```
if some_list:
    ... do something

if some_string:
    ... do something 
```

在这两种情况下，这些条件只是意味着，“如果集合不为空”。

### 多个返回值

当我们使用条件来控制在函数或方法中触发哪个`return`语句时，我们可以更进一步。

例如，我们可能有一个函数，要求用户输入姓名，然后返回姓名，或者如果用户没有输入姓名，则返回`"John Doe"`。利用我们在上面学到的知识，我们可以写出这样的东西:

```
def get_name():
    name = input("Please enter your name: ")

    if name:
        return name

    return "John Doe" 
```

然而，我们可以利用布尔运算符`or`来大大缩短这个过程。

```
def get_name():
    name = input("Please enter your name: ")

    return name or "John Doe" 
```

Python 中的`or`操作符如果计算结果为`True`，则产生第一个操作数，在我们的例子中，这意味着`name`字符串不为空，否则产生第二个操作数。因此，在用户输入姓名的任何情况下，`get_name`函数都会返回`name`；否则返回`"John Doe"`。

这一招也适用于作业！

再一次，我们有一篇关于布尔运算符的博文，我们在其中讨论了`or`的这个有用的属性。

## （听力或阅读）理解测试

在这篇文章中，我想说的最后一件事是使用理解。理解用于从另一个 iterable 创建新的集合，在这些情况下，它们是更冗长的 for 循环语法的替代方法。就我个人而言，我绝对爱他们！

举个例子，也许我们有一个小写名字的列表，我们想要一个新的列表，其中所有的名字都是大写字母。for 循环版本如下所示:

```
names = ["rolf", "james", "jose", "sarah", "lucy"]
title_names = []

for name in names:
    title_names.append(name.title()) 
```

这种方法的一个限制是我们不能重用`names`变量名，即使我们不再打算使用这些值。它也有相当多的样板代码。

理解版应该是这样的:

```
names = ["rolf", "james", "jose", "sarah", "lucy"]
names = [name.title() for name in names] 
```

或者，如果我们想保留原始列表:

```
names = ["rolf", "james", "jose", "sarah", "lucy"]
title_names = [name.title() for name in names] 
```

我们有几个关于列表理解的帖子。第一个涵盖了我们上面看到的基本列表理解，[第二个](https://blog.teclado.com/python-list-comprehensions-conditionals/)涵盖了带有条件句的列表理解。

Python 也有其他类型的理解，比如集合理解和字典理解，它们可以以非常相似的方式使用。我在另一篇文章中谈到过这些[。](https://www.codementor.io/philbest/python-comprehensions-are-awesome-wp8r945xv)

理解是你学习的一个很好的工具，所以一定要熟悉它们。

## 包扎

这是一个相当长的，所以谢谢你坚持到最后！我希望你学到了一些新的技巧来帮助你清理你的 Python 代码。

在我们的[完整 Python 课程](https://www.udemy.com/course/the-complete-python-course/)中，我们涵盖了很多类似的内容，所以如果你有兴趣将你的 Python 提升到一个新的水平，可以去看看。

我们在 [Discord](https://discord.gg/V9StqZ) 上还有一个社区，你可以在那里获得帮助和建议，还有一个邮件列表，这样你就可以及时了解我们所有的内容。我们还向我们的订户发送折扣代码，所以请确保在下面注册，以获得我们课程的最优惠价格。*