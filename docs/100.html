<html>
<head>
<title>Work with dates and times in Python using datetime</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1>使用日期时间在Python中处理日期和时间</h1>
<blockquote>原文：<a href="https://blog.teclado.com/how-to-work-with-dates-times-python-datetime/">https://blog.teclado.com/how-to-work-with-dates-times-python-datetime/</a></blockquote><div><div class="post-content">
<p><code>datetime</code>模块是Python中的一个内置模块，允许我们轻松处理日期和时间。在这个模块中我们可以找到几个类，但是最常用的是<code>datetime</code>和<code>timedelta</code>。</p><p>这通常意味着我们在<code>datetime</code>模块中使用<code>datetime</code>类——有些令人困惑，但这就是为什么当你查看使用它的Python代码时，你通常会看到像<code>datetime.datetime</code>这样的东西。</p><h2 id="what-is-a-datetime-object">什么是<code>datetime</code>对象？</h2><p>简单地说，<code>datetime</code>对象是存储特定时间点信息的对象。年、月、日、小时、分钟和秒等信息。有了这些信息，我们就可以用一个<code>datetime</code>对象来指代某个特定的时刻。例如:</p><pre><code class="language-python">import datetime

today = datetime.datetime(year=2019, month=12, day=23, hour=11, minute=49, second=30)
print(today)  # 2019-12-23 11:49:30
</code></pre><p>除了存储特定时间点的数据，它还有一些方法可以帮助我们以一种有意义的方式与数据交互或处理数据。</p><p>例如，给定两个<code>datetime</code>物体，你可以比较它们，看看哪一个更接近未来。</p><pre><code class="language-python">import datetime

today = datetime.datetime(year=2019, month=12, day=23, hour=11, minute=49, second=30)
tomorrow = datetime.datetime(year=2019, month=12, day=24, hour=11, minute=49, second=30)
print(today &gt; tomorrow)  # False
</code></pre><p>这里我们将打印出<code>False</code>，因为<code>today</code>相对于<code>tomorrow</code>来说是过去的事了。这就是我们如何比较两个日期，例如，判断过去是否发生了什么事情。</p><h2 id="how-to-get-today-s-date">如何获得今天的日期</h2><p>因为获取今天的日期非常常见，所以<code>datetime</code>类附带了一个方法，您可以使用该方法获取今天的日期的新的<code>datetime</code>对象:</p><pre><code class="language-python">import datetime

print(datetime.datetime.now())
# 2019-12-23 11:54:13.151509
</code></pre><p>您也可以使用<code>datetime.datetime.today()</code>来获得当前的时间和日期，但有时可能不够精确。此外，它现在允许我们给它时区信息(稍后会有更多！)</p><p>请注意，当我们这样做时，我们得到的是微秒以及其他时间度量。这可能是不必要的，但在处理计算机时，它有时会很有用。</p><h2 id="how-to-modify-dates">如何修改日期</h2><p>你不能把两个日期加在一起，因为那很少有意义。比如把“今天”加到“今天”上应该会怎么样？</p><pre><code class="language-python">import datetime

print(datetime.datetime.now() + datetime.datetime.now())
# Error
</code></pre><p>相反，当你想改变一个日期时——例如增加几天——我们使用<code>timedelta</code>类。数学中的一个“delta”就是“变化”的意思，所以这个名字就是这么来的。</p><pre><code class="language-py">import datetime

today = datetime.datetime.now()
one_week = datetime.timedelta(days=7)

print(today + one_week) # 2019-12-30 11:58:52.073407
</code></pre><p>您可以将<code>timedelta</code>与这些参数一起使用:</p><ul><li><code>days</code></li><li><code>seconds</code></li><li><code>microseconds</code></li><li><code>milliseconds</code></li><li><code>minutes</code></li><li><code>hours</code></li><li><code>weeks</code></li></ul><p>但是对象本身只会存储<code>days</code>、<code>seconds</code>和<code>microseconds</code>。所有其他参数都将被转换成这些参数(例如，<code>minutes * 60</code>将被添加到<code>seconds</code>)。</p><h2 id="how-to-display-dates">如何显示日期</h2><p>您可以使用内置的<code>str()</code>函数将日期<code>print</code>转换成字符串，这样它们就会以这种格式显示:</p><pre><code class="language-python">import datetime

print(datetime.datetime.now())
# 2019-12-23 11:54:13.151509
</code></pre><p>有时，您可能希望在如何打印方面有更大的灵活性。也许您只想打印出日期部分。或者也许，只是“小时和分钟”。</p><p>你可以通过使用<code>.strftime()</code>来做到这一点，它代表“<strong>str</strong>ing<strong>f</strong>format<strong>time</strong>”。</p><pre><code class="language-python">import datetime

today = datetime.datetime.now()

print(today.strftime("%Y-%m-%d")
# 2019-12-23

print(today.strftime("%H:%M")
# 11:54
</code></pre><p>这样做根本不会修改<code>today</code>对象，它只是创建一个表示日期或时间的字符串，如所传递的“格式字符串”所示。</p><p>这是一个很好的参考，所有不同的事情你都可以传给<code>strftime</code>:<a href="https://strftime.org/">https://strftime.org/</a>(<a href="https://strftime.org/">https://strftime.org/</a>)。</p><h2 id="how-to-parse-dates">如何解析日期</h2><p>与打印特定格式的日期非常相似，我们可以读入特定格式的日期。</p><p>例如，假设您的用户给了您一个描述今天日期的字符串:<code>23-12-2019</code>。很明显，这个字符串的格式是“日-月-年”。以Python <code>datetime</code>格式:<code>"%d-%m-%Y"</code>。</p><p>我们可以使用<code>.strptime</code>将日期字符串解析成<code>datetime</code>对象:</p><pre><code class="language-python">import datetime

user_date = input("Enter today's date: ")
# Assume they entered 23-12-2019

today = datetime.datetime.strptime(user_date, "%d-%m-%Y")
print(today)  # 2019-12-23 00:00:00
</code></pre><p>与我们在<code>strftime</code>中使用的相同的格式字符串可以在<code>strptime</code>中使用</p><h2 id="what-is-a-timestamp">什么是时间戳？</h2><p>时间戳是自1970年1月1日午夜以来经过的秒数。</p><p>我们使用时间戳是因为处理单个数字(尽管很大)比处理多个数字更容易，每个数字描述一个不同的度量。</p><p>“1970年1月2日，午夜”的时间戳将是<code>86400</code>:一天中的秒数。</p><p>要获得时间戳，您可以调用任何<code>datetime</code>对象的<code>timestamp()</code>方法:</p><pre><code class="language-python">import datetime

today = datetime.datetime.now()
print(today.timestamp())  # 1577104357.558527
</code></pre><p>因为现在获取<em>的时间戳<em>非常常见，所以我们可以使用<code>time</code>模块更容易地获取它:</em></em></p><pre><code class="language-py">import time

print(time.time())  # 1577104492.7515678
</code></pre><h2 id="timezones">Timezones</h2><p>时区是使用相同标准时间的区域。</p><p>例如，许多西欧国家使用相同的标准时间——西班牙、法国、意大利、德国等。它们都处于“中欧时间”时区。在夏季，当夏令时生效时，它们都处于“中欧夏令时”时区。</p><p>如果你在一台使用CET的计算机上运行Python，那么做<code>datetime.datetime.now()</code>会给你计算机的本地时间。</p><p>然而，如果你拿到一台使用太平洋标准时间的不同电脑，那么<code>datetime.datetime.now()</code>会给你一个不同的时间。</p><p>这就是为什么告诉<code>datetime</code>对象它们所代表的时间是在哪个时区是很重要的:这样无论什么计算机运行代码，所代表的时间总是相同的。</p><p>“中部”时间称为协调世界时(UTC)。所有其他时区都可以用UTC作为参考来描述。例如，CET是UTC + 1小时。PST是UTC - 6小时。</p><p>因此，我们将CET写成<code>+01:00</code>，PST写成<code>-06:00</code>。</p><p>我们称之为“偏移量”，通常放在日期和时间之后。例如:</p><pre><code>2019-12-23 11:54:13+01:00
</code></pre><p>以上时间为11:54，偏移1小时。</p><p>这意味着该时区可能是CET(或任何其他与UTC相差+1小时的时区)。</p><p>我们可以通过从时间中减去1小时来计算UTC时间，这将使我们处于10:54。</p><h2 id="getting-the-current-date-and-time-in-utc">获取UTC中的当前日期和时间</h2><p>我们了解到，您可以像这样获取当地时间:</p><pre><code class="language-py">import datetime

today = datetime.datetime.now()
print(today) # 2019-12-23 15:35:56.133138
</code></pre><p>这样做的时候，你可以让Python获取当前时间，但是要转换成不同的时区。下面我们将<code>datetime.timezone.utc</code>传递给<code>.now()</code>,这样Python就会给出UTC时区的当前时间。</p><pre><code class="language-py">import datetime

today = datetime.datetime.now(datetime.timezone.utc)
print(today) # 2019-12-23 15:35:56.133138+00:00
</code></pre><p>你可以看到在我的例子中，时间是一样的。这是因为此时我的时区也有+00:00的偏移量，所以它与UTC一致。</p><p>如果您的时区与UTC不匹配，您将看到这两个时间是不同的(实际上，这种差异就是您的时区与UTC的偏移量)。</p><p>注意，当我们在不传递时区的情况下执行<code>.now()</code>时，我们打印的字符串不包含偏移量。但是当我们做<code>.now(datetime.timezone.utc)</code>时，打印的字符串包含了<code>+00:00</code>偏移量。</p><h3 id="naive-vs-aware-datetimes">天真与清醒的约会时间</h3><p>如果你的<code>datetime</code>对象知道它所代表的日期和时间在哪个时区，那么我们称之为<strong>感知</strong> <code>datetime</code>对象。如果它没有时区信息，我们称之为<strong>幼稚</strong>对象。</p><p>感知物体代表世界上特定地方的特定时间点。幼稚对象只代表特定的时间点。</p><p>注意，使用简单对象可能是危险的，因为不同的代码段可能会将简单对象解释为使用不同的时区。例如，您的一些代码可能使用一个简单的对象<em>，就好像它是UTC中的</em>。其他一些代码可能会使用一个简单的对象<em>，就好像它是当前本地时区的</em>。</p><p>因此，将时区信息存储在您的<code>datetime</code>对象中几乎总是一个好主意。</p><h2 id="converting-from-one-timezone-to-another-using-pytz">使用pytz从一个时区转换到另一个时区</h2><p>您可以使用内置的<code>datetime</code>模块从一个时区转换到另一个时区，但是您需要通过为每个时区编写一个子类<code>datetime.tzinfo</code>类的类来告诉Python存在哪些时区以及可以使用哪些时区。您还必须做大量的手工工作，以便您的时区类跟踪夏令时。</p><p>或者，您可以在Python代码中使用(或许应该使用)用于处理时区的<code>pytz</code>模块。</p><p>首先，按照<a href="http://pytz.sourceforge.net/#installation">的安装说明</a>或使用<code>pip install pytz</code>安装<code>pytz</code>。</p><h3 id="getting-a-timezone-from-pytz">从pytz获取时区</h3><p><code>pytz</code>模块带有一个完整的时区数据库，可以通过它们的<a href="https://timezonedb.com/time-zones">官方名称</a>访问:</p><pre><code class="language-python">import pytz

eastern = pytz.timezone("US/Eastern")
amsterdam = pytz.timezone("Europe/Amsterdam")
</code></pre><h3 id="adding-timezone-information-to-a-native-datetime">将时区信息添加到本机日期时间中</h3><p>如果您有一个简单的<code>datetime</code>对象(来自内置模块)，您可以使用<code>pytz</code>来添加时区信息:</p><pre><code class="language-python">import datetime
import pytz

eastern = pytz.timezone("US/Eastern")

local_time = datetime.datetime.now()
print(local_time)  # 2020-02-12 11:47:21.817708
eastern_time = eastern.localize(local_time)
print(eastern_time)  # 2020-02-12 11:47:21.817708-05:00
</code></pre><p>注意，这样做不会改变<code>datetime</code>对象中的时间信息。</p><h3 id="converting-from-one-timezone-to-another">从一个时区转换到另一个时区</h3><p>如果你有一个aware <code>datetime</code>对象，你想把它转换到另一个时区，那么你也可以用<code>pytz</code>来做这件事:</p><pre><code class="language-python">import datetime
import pytz

eastern = pytz.timezone("US/Eastern")
amsterdam = pytz.timezone("Europe/Amsterdam")

local_time = datetime.datetime.now()
eastern_time = eastern.localize(local_time)
print(eastern_time)  # 2020-02-12 11:47:21.817708-05:00

amsterdam_time = eastern_time.astimezone(amsterdam)
print(amsterdam_time)  # 2020-02-12 17:47:21.817708+01:00
</code></pre><p>现在显示的时间已经改变，因为它是相同的日期和时间，但在不同的时区。<code>eastern_time</code>和<code>amsterdam_time</code>指的是同一个确切的时间点。</p><p>您可以通过自己将每一项转换为UTC来确保这一点。在<code>eastern_time</code>上加5小时，在<code>amsterdam_time</code>上减1小时，得到+00:00的偏移量。你会发现时间是一样的。</p><h3 id="dealing-with-daylight-savings">应对夏令时</h3><p><code>pytz</code>模块与您一起处理夏令时。例如，<code>US/Eastern</code>时区有时可能在<code>-05:00</code>而其他时间在<code>-04:00</code>，这取决于一年中的时间。</p><p>下面是一个例子</p><h2 id="working-with-dates-and-times-in-software-applications">在软件应用程序中处理日期和时间</h2><p>通常我会建议在您的应用程序中始终使用UTC。向用户询问当地时间和时区，并将其转换为UTC。将UTC存储在数据库中。仅当您向用户显示日期和时间时，才变回用户的本地时间(并且仅当您的用户希望以他们的本地时间查看时间时)。</p><p>这样，您就不必担心应用程序逻辑中的时区问题；只有在处理用户交互的时候。</p><p><code>pytz</code>模块带有一个<code>pytz.utc</code>时区，你可以在构造<code>datetime</code>对象时使用它来简化这个过程:</p><pre><code class="language-python">import datetime
import pytz

eastern = pytz.timezone("US/Eastern")

user_date = datetime.datetime(2020, 4, 15, 6, 0, 0, tzinfo=eastern)
utc_date = user_date.astimezone(pytz.utc)
print(utc_date)  # 2020-04-15 10:56:00+00:00
</code></pre><p>只要您始终使用UTC，并且在显示信息时只转换到用户的本地时区，这就相对简单了！</p><h2 id="wrapping-up">包扎</h2><p>感谢您阅读这篇关于使用<code>datetime</code>和<code>pytz</code>在Python中处理日期和时间的博文。希望对你有用！</p><p>如果你想从整体上了解更多关于Python的知识，请查看我们的<a href="https://go.tecla.do/complete-python-sale">完整Python课程</a>。这是一个30小时的视频课程，带你从Python初学者到专家。我们很想在那里见到你！</p>
</div>
</div>    
</body>
</html>