<html>
<head>
<title>Creating Snake Using Tkinter's Canvas Widget (Part 1)</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1>使用Tkinter的Canvas小部件创建Snake(第1部分)</h1>
<blockquote>原文：<a href="https://blog.teclado.com/write-snake-game-python-tkinter-part-1/">https://blog.teclado.com/write-snake-game-python-tkinter-part-1/</a></blockquote><div><div class="post-content">
<p>你好，欢迎来到关于用Tkinter开发GUI的另一篇文章。本周我们暂时停止学习Tkinter的技术细节，我们将使用Tkinter非常强大的<code>Canvas</code>小工具重新制作流行的街机游戏Snake。</p><p>这篇文章将会更高级一点，所以如果你以前从未使用过Tkinter，我建议你看看我们之前的文章，这样你会对Tkinter的工作原理有更多的了解。</p><p>您可以在下面的链接中找到这个小项目的完整代码，但我真的建议您和我一起编写代码，因为这将有助于让概念变得清晰:<a href="https://github.com/tecladocode/tkinter-snake/blob/master/app.py">https://github . com/tecladocode/tkinter-snake/blob/master/app . py</a></p><p>您还会发现我们在应用程序中使用的少量资源，因此请确保获取它们！</p><p>如果你更喜欢看视频，Jose已经在YouTube上为你创建了一个很棒的演示！</p><h2 id="setting-up-the-main-window">设置主窗口</h2><p>首先，我们将编写大量样板tkinter代码，导入Tkinter模块并设置主应用程序窗口。</p><pre><code class="language-python">import tkinter as tk

root = tk.Tk()
root.mainloop()
</code></pre>
<p>这些都是我们在之前的帖子中见过的东西。</p><p>既然我们正在开发一个重要的应用程序，我们还将添加一些新的配置。我们将为应用程序窗口添加一个标题，并防止窗口被调整大小。我们的贪吃蛇游戏将在一个固定尺寸的棋盘上进行，所以允许窗口调整大小并没有太大的意义。</p><p>我们还将添加执行像素缩放的线条，这将使我们的文本和图像在更高的dpi显示器上看起来更清晰。</p><pre><code class="language-python">import tkinter as tk

root = tk.Tk()
root.title("Snake")
root.resizable(False, False)
root.tk.call("tk", "scaling", 4.0)

root.mainloop()
</code></pre>
<p>非常简单，但是其他两行可能需要一些解释。</p><p><code>root.resizable</code>是我们用来防止窗口被调整大小的。它有两个不同的参数，因为如果我们愿意，我们可以阻止窗口只沿x或y轴调整大小。在这里，我们通过为两个值传入<code>False</code>来禁用两个维度的大小调整。</p><p><code>root.tk.call("tk", "scaling", 4.0)</code>行告诉Tkinter使用4x像素缩放。我们可以设置一个不同的值，比如这里的<code>2.0</code>:我只是选择了一个更高的缩放级别来考虑非常密集的显示。</p><p>这样，我们就可以让主窗口工作，并按照我们想要的方式进行设置。现在让我们看看如何添加我们的<code>Canvas</code>小部件，它将构成应用程序的主体。</p><h2 id="defining-the-board">定义纸板</h2><p>对于这个应用程序，我们将采用面向对象的方法来编写我们的Tkinter代码，这是我们以前从未见过的。</p><p>如果你不熟悉面向对象编程，我们有<a href="https://go.tecla.do/complete-python-sale">完整的视频课程</a>供你选择，或者有<a href="https://teclado.com/30-days-of-python/python-30-day-0-getting-set-up/">免费的30天文本课程</a>涵盖你需要知道的一切。</p><p>对于我们的应用程序，我们将定义一个<code>Snake</code>类，它将是<code>Canvas</code>小部件的子部件。这意味着我们将可以访问<code>Canvas</code>对象可用的属性和方法，但我们也将定义大量自己的属性和方法。</p><p>首先，让我们定义我们的<code>Snake</code>类，并定义<code>__init__</code>方法，这样我们可以传入一些配置。我们还将利用<code>super</code>来访问<code>Canvas</code>小部件的<code>__init__</code>方法，这样我们就可以定义<code>Canvas</code>本身的一些初始配置。</p><pre><code class="language-python">import tkinter as tk


class Snake(tk.Canvas):
    def __init__(self):
        super().__init__(
            width=600, height=620, background="black", highlightthickness=0
        )


root = tk.Tk()
root.title("Snake")
root.resizable(False, False)
root.tk.call("tk", "scaling", 4.0)

root.mainloop()
</code></pre>
<p>这里我们创建了一个600乘620像素的小部件，它有一个黑色背景，没有边框高亮。</p><p>然而，目前我们的应用程序窗口中不会显示任何内容，因为我们还没有指定要使用的几何管理器，我们也没有实例化我们的类。</p><p>我们将在这个应用程序中使用<code>pack</code>几何管理器，因为布局非常简单，我们将调用<code>Snake</code>类的<code>__init__</code>方法中的<code>pack</code>方法。我们所有的配置都将存在于这个<code>__init__</code>方法中。</p><p>我们还将实例化我们的<code>Snake</code>类的一个对象，并将其命名为<code>board</code>。</p><pre><code class="language-python">import tkinter as tk


class Snake(tk.Canvas):
    def __init__(self):
        super().__init__(
            width=600, height=620, background="black", highlightthickness=0
        )

        self.pack()


root = tk.Tk()
root.title("Snake")
root.resizable(False, False)
root.tk.call("tk", "scaling", 4.0)

board = Snake()

root.mainloop()
</code></pre>
<p>这样，我们现在有了一个非常令人兴奋的黑盒子:</p><figure class="kg-card kg-image-card"><img src="../Images/15e6624796275ea605c051bea3ab9a93.png" class="kg-image" alt="" loading="lazy" data-original-src="https://blog.teclado.com/content/images/2019/09/Screenshot-from-2019-08-22-19-55-54.png"/></figure><p>我们开始放些东西进去吧。</p><h2 id="adding-items-to-our-canvas">向我们的<code>Canvas</code>添加项目</h2><p>我们将在画布上添加一些不同类型的元素。我们的资产文件夹中有一些png图像，一些内置形状，还有一些文本。</p><p>让我们从图像开始，因为这是迄今为止最复杂的过程。我们将使用两种不同的方法将图像添加到我们的<code>Canvas</code>中。第一个负责将图像加载到我们的应用程序中，第二个负责将东西放到<code>Canvas</code>中。</p><h3 id="loading-our-image-assets">加载我们的图像资产</h3><p>因此，我们的第一步是加载我们的资产。在我们的资产文件夹中有两个不同的图像:一个小的绿色方块代表蛇的部分，一个小的紫色方块代表水果。如果你想让你的代币更精致，那就去做吧！</p><p>我们将定义一个<code>load_assets</code>方法来处理这两种资产。</p><p>在<code>load_assets</code>中，我们将定义一个<code>try</code> / <code>except</code>块，这样我们就可以处理加载文件时出现的任何潜在错误。我们不会在这里做任何花哨的事情。我们将打印错误并销毁根窗口对象。</p><p>在<code>try</code>块中，我们将加载并处理图像。为了处理我们的png图像，我们需要利用<code>PIL</code> (Python图像库)，所以我们需要导入它。Python没有附带它，所以你必须使用<code>pip</code>来安装它。</p><pre><code>pip install pillow
</code></pre><p>如果你已经用<code>pipenv</code>建立了一个虚拟环境，就像我们的仓库一样，你应该用<code>pipenv</code>来安装它。</p><p>我们需要来自<code>PIL</code>的<code>Image</code>类和<code>ImageTk</code>类，因此我们的导入将如下所示:</p><pre><code class="language-python">from PIL import Image, ImageTk
</code></pre>
<p>一旦我们在<code>try</code>块中处理了我们的图像，我们就可以在<code>__init__</code>中调用<code>load_assets</code>方法。</p><p>你可以在下面看到这个样子:</p><pre><code class="language-python">import tkinter as tk
from PIL import Image, ImageTk


class Snake(tk.Canvas):
    def __init__(self):
        super().__init__(
            width=600, height=620, background="black", highlightthickness=0
        )

        self.load_assets()
        self.pack()

    def load_assets(self):
        try:
            self.snake_body_image = Image.open("./assets/snake.png")
            self.snake_body = ImageTk.PhotoImage(self.snake_body_image)

            self.food_image = Image.open("./assets/food.png")
            self.food = ImageTk.PhotoImage(self.food_image)
        except IOError as error:
            print(error)
            root.destroy()


root = tk.Tk()
root.title("Snake")
root.resizable(False, False)
root.tk.call("tk", "scaling", 4.0)

board = Snake()

root.mainloop()
</code></pre>
<p>当我们想要将蛇的身体添加到<code>Canvas</code>中时，我们现在可以使用<code>self.snake_body</code>作为图像，这同样适用于我们以这种方式定义的任何其他资产。</p><h3 id="adding-our-images-to-the-canvas">将我们的图像添加到<code>Canvas</code></h3><p>现在我们已经装载了资产，我们可以开始向<code>Canvas</code>添加东西了。我们将为此使用另一个名为<code>create_objects</code>的自定义方法。</p><p><code>Canvas</code>小部件实际上附带了一个名为<code>create_image</code>的方法，我们将用它来将图像资产添加到<code>Canvas</code>。这个方法接受对象的x和y位置，一个传递给<code>image</code>参数的处理过的图像，以及一个可选的<code>tag</code>，我们将为所有的<code>Canvas</code>项定义它，因为它使得在我们的代码中更容易找到它们。</p><p>首先，让我们添加蛇的身体。我们将从一条有三个身体部分的蛇开始游戏，所以我们必须在画布上添加三个独立的对象。</p><p>在我看来，跟踪所有的蛇段在哪里是很有用的，因为我们以后要检查碰撞等等。，所以我认为我们应该在我们的<code>__init__</code>方法中为蛇指定起始坐标，然后我们可以在蛇每次移动时更新坐标。</p><pre><code class="language-python">class Snake(tk.Canvas):
    def __init__(self):
        super().__init__(
            width=600, height=620, background="black", highlightthickness=0
        )

        self.snake_positions = [(100, 100), (80, 100), (60, 100)]

        self.load_assets()
        self.pack()
</code></pre>
<p>我们的<code>self.snake_positions</code>属性被绑定到一个元组列表，其中每个元组包含一个x和一个y坐标。</p><p>我们现在可以在我们的<code>create_objects</code>方法中为每个坐标添加一个蛇段。由于我们一遍又一遍地重复相同的代码，我将使用一个for循环和一些<a href="https://blog.teclado.com/destructuring-in-python/">析构</a>来添加每一段:</p><pre><code class="language-python">class Snake(tk.Canvas):
    def __init__(self):
        super().__init__(
            width=600, height=620, background="black", highlightthickness=0
        )

        self.snake_positions = [(100, 100), (80, 100), (60, 100)]

        self.load_assets()
        self.create_objects()

        self.pack()

    def load_assets(self):
        try:
            self.snake_body_image = Image.open("./assets/snake.png")
            self.snake_body = ImageTk.PhotoImage(self.snake_body_image)

            self.food_image = Image.open("./assets/food.png")
            self.food = ImageTk.PhotoImage(self.food_image)
        except IOError as error:
            print(error)
            root.destroy()

    def create_objects(self):
        for x_position, y_position in self.snake_positions:
            self.create_image(
                x_position, y_position, image=self.snake_body, tag="snake"
            )
</code></pre>
<p>如果我们运行我们的代码，我们现在有一些漂亮的绿色方块在画布上代表我们的蛇！</p><figure class="kg-card kg-image-card"><img src="../Images/82462f158d4144b82ae66d1738e40952.png" class="kg-image" alt="" loading="lazy" data-original-src="https://blog.teclado.com/content/images/2019/09/Screenshot-from-2019-08-23-11-40-30.png"/></figure><p>加入食物是非常相似的。首先我们要定义一个新的属性来跟踪食物在哪里，然后我们要使用<code>create_image</code>将<code>self.food</code>图像添加到<code>Canvas</code>中。</p><p>现在，我们将为食物的起始位置指定一个静态位置，但是稍后我们将定义一个方法，将食物随机放置在<code>Canvas</code>上，确保避开蛇。</p><p>食物的位置也是一个包含x和y坐标的元组，所以我们可以在<code>create_image</code>方法中解包这个元组，使用<code>*</code>一次性提供x和y坐标值:</p><pre><code class="language-python">class Snake(tk.Canvas):
    def __init__(self):
        super().__init__(
            width=600, height=620, background="black", highlightthickness=0
        )

        self.snake_positions = [(100, 100), (80, 100), (60, 100)]
        self.food_position = (200, 200)

        self.load_assets()
        self.create_objects()

        self.pack()

    def load_assets(self):
        try:
            self.snake_body_image = Image.open("./assets/snake.png")
            self.snake_body = ImageTk.PhotoImage(self.snake_body_image)

            self.food_image = Image.open("./assets/food.png")
            self.food = ImageTk.PhotoImage(self.food_image)
        except IOError as error:
            print(error)
            root.destroy()

    def create_objects(self):
        for x_position, y_position in self.snake_positions:
            self.create_image(
                x_position, y_position, image=self.snake_body, tag="snake"
            )
        
        self.create_image(*self.food_position, image=self.food, tag="food")
</code></pre>
<p>我们现在在<code>Canvas</code>上有一个漂亮的紫色方块代表食物:</p><figure class="kg-card kg-image-card"><img src="../Images/dc3f1ccf2946c7b700ef6c6de5ad4f22.png" class="kg-image" alt="" loading="lazy" data-original-src="https://blog.teclado.com/content/images/2019/09/Screenshot-from-2019-08-23-11-47-15.png"/></figure><p>这样，我们所有的图像都被添加进去了！</p><h3 id="adding-the-other-canvas-objects">添加其他<code>Canvas</code>对象</h3><p>我们可能已经添加了所有的图像，但是我们还没有把东西放到<code>Canvas</code>上。我们仍然需要添加一些文本来显示当前的分数，我们需要一个框来定义可玩的区域。</p><p>为了将分数文本添加到<code>Canvas</code>中，我们需要定义另一个属性来跟踪当前分数。</p><p>向<code>Canvas</code>添加文本与添加图像非常相似，我们只是使用了<code>create_text</code>方法。同样，我们的前两个参数是一组x和y坐标，但是我们也将为<code>text</code>、<code>tag</code>、<code>fill</code>和<code>font</code>提供值。</p><p><code>text</code>只是我们想要定位的实际字符，而<code>tag</code>将以与您的图像类似的方式使用。它让我们可以在出于某种原因需要时快速获得画布部件，</p><p><code>fill</code>用于设置文本颜色，这里我们用十六进制的<code>#fff</code>来写简单的白色。如果你想要不同的颜色，你可以把它换成任何你想要的颜色！</p><p>在我们的例子中，<code>font</code>将用于设置字体大小，但是如果你愿意，你也可以指定一种字样。为此，首先用字样传入一组值。</p><p>我们更新后的<code>create_objects</code>方法如下所示:</p><pre><code class="language-python">def create_objects(self):
    self.create_text(
        35, 12, text=f"Score: {self.score}", tag="score", fill="#fff", font=10
    )

    for x_position, y_position in self.snake_positions:
        self.create_image(
            x_position, y_position, image=self.snake_body, tag="snake"
        )
    
    self.create_image(*self.food_position, image=self.food, tag="food")
</code></pre>
<p>我们还将把<code>self.score = 0</code>添加到我们的<code>__init__</code>方法中。</p><p>最后，我们将为可玩区域添加一个边界，以便玩家知道边界在哪里。为此，我们将使用Tkinter的<code>Canvas</code>小部件固有的形状之一，我们用另一个内置方法:<code>create_rectangle</code>创建它。</p><p>在Tkinter <code>Canvas</code>中定义矩形时，我们实际上需要四个值。前两个值是左上角的x和y坐标，后两个值是右下角的x和y坐标。根据这些值，Tkinter可以计算出其他角的位置。</p><p>我们的坐标看起来会有点奇怪，因为我添加了3个像素的偏移量，这样当蛇沿着其中一条边移动时，它就不会碰到边界。只是有一点空隙看起来更好。如果你想消除差距，你可以把所有的数字四舍五入到最接近的10。</p><p>除了指定矩形的坐标，我们还将通过向参数<code>outline</code>传递一个十六进制颜色值来定义轮廓颜色。</p><pre><code class="language-python">def create_objects(self):
    self.create_text(
        35, 12, text=f"Score: {self.score}", tag="score", fill="#fff", font=10
    )

    for x_position, y_position in self.snake_positions:
        self.create_image(
            x_position, y_position, image=self.snake_body, tag="snake"
        )
    
    self.create_image(*self.food_position, image=self.food, tag="food")
    self.create_rectangle(7, 27, 593, 613, outline="#525d69")
</code></pre>
<p>这样，我们所有的物品都在<code>Canvas</code>上:</p><figure class="kg-card kg-image-card"><img src="../Images/e5c2fae8b6a6f23822383c0f928ff3d6.png" class="kg-image" alt="" loading="lazy" data-original-src="https://blog.teclado.com/content/images/2019/09/Screenshot-from-2019-08-23-14-16-23.png"/></figure><h2 id="wrapping-up">包扎</h2><p>我们都准备好了，我想现在是停下来的好地方。在下一篇文章中，我们将负责添加所有的功能，到最后，我们将有一个工作的snake应用程序供您使用！</p><p>我希望你喜欢和我一起创建这个应用程序，如果你有兴趣学习更多关于GUI开发的知识，我们刚刚发布了关于这个主题的整个课程！查看使用Python和Tkinter进行GUI开发的<a href="https://go.tecla.do/tkinter-gui-course-sale">课程！</a></p>
</div>
</div>    
</body>
</html>