<html>
<head>
<title>Day 21: Exercise Solutions | Teclado</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1>第21天:锻炼解决方案| Teclado</h1>
<blockquote>原文：<a href="https://blog.teclado.com/python-30-day-21-exercise-solutions/">https://blog.teclado.com/python-30-day-21-exercise-solutions/</a></blockquote><div><article class="pb-12 prose prose-p:font-copy col-start-2 dark:prose-invert">
                    
                    <p>下面是我们对<a href="https://blog.teclado.com/30-days-of-python">Python</a>30天<a href="/30-days-of-python/python-30-day-21-multiple-files">第21天练习</a>的解决方案！请记住，在通读我们的解决方案之前，自己动手做练习。</p>
<h2>1)将代码拆分成文件</h2>
<p>这个练习既是阅读和理解代码的练习，也是分解代码的练习。</p>
<p>但是真的，这才是重点！当您阅读并理解代码时，您可以开始将代码视为由做不同事情的不同部分组成。</p>
<p>对我们来说，不同的部分是相对清晰的:我们有一组面向用户的功能和一组面向数据的功能。</p>
<p>与用户交互的功能有:</p>
<ul>
<li><code>menu()</code></li>
<li><code>prompt_add_book()</code></li>
<li><code>list_books()</code></li>
<li><code>prompt_read_book()</code></li>
<li><code>prompt_delete_book()</code></li>
</ul>
<p>以及与数据存储(本例中是一个JSON文件)交互的函数:</p>
<ul>
<li><code>create_book_table()</code></li>
<li><code>get_all_books()</code></li>
<li><code>insert_book()</code></li>
<li><code>save_all_books()</code></li>
<li><code>mark_book_as_read()</code></li>
<li><code>delete_book()</code></li>
</ul>
<p>考虑到这一点，我们可以将文件分成两个文件:每个文件对应一段代码。</p>
<p>我们最终会得到类似于<code>main.py</code>的包含面向用户代码的东西:</p>
<div class="codehilite"><span class="filename">main.py</span><pre><span/><code><span class="kn">import</span> <span class="nn">database</span>

<span class="n">USER_CHOICE</span> <span class="o">=</span> <span class="s2">"""</span>
<span class="s2">Enter:</span>
<span class="s2">- 'a' to add a new book</span>
<span class="s2">- 'l' to list all books</span>
<span class="s2">- 'r' to mark a book as read</span>
<span class="s2">- 'd' to delete a book</span>
<span class="s2">- 'q' to quit</span>

<span class="s2">Your choice: """</span>

<span class="k">def</span> <span class="nf">menu</span><span class="p">():</span>
    <span class="n">database</span><span class="o">.</span><span class="n">create_book_table</span><span class="p">()</span>
    <span class="n">user_input</span> <span class="o">=</span> <span class="nb">input</span><span class="p">(</span><span class="n">USER_CHOICE</span><span class="p">)</span>
    <span class="k">while</span> <span class="n">user_input</span> <span class="o">!=</span> <span class="s1">'q'</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">user_input</span> <span class="o">==</span> <span class="s1">'a'</span><span class="p">:</span>
            <span class="n">prompt_add_book</span><span class="p">()</span>
        <span class="k">elif</span> <span class="n">user_input</span> <span class="o">==</span> <span class="s1">'l'</span><span class="p">:</span>
            <span class="n">list_books</span><span class="p">()</span>
        <span class="k">elif</span> <span class="n">user_input</span> <span class="o">==</span> <span class="s1">'r'</span><span class="p">:</span>
            <span class="n">prompt_read_book</span><span class="p">()</span>
        <span class="k">elif</span> <span class="n">user_input</span> <span class="o">==</span> <span class="s1">'d'</span><span class="p">:</span>
            <span class="n">prompt_delete_book</span><span class="p">()</span>

        <span class="n">user_input</span> <span class="o">=</span> <span class="nb">input</span><span class="p">(</span><span class="n">USER_CHOICE</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">prompt_add_book</span><span class="p">():</span>
    <span class="n">name</span> <span class="o">=</span> <span class="nb">input</span><span class="p">(</span><span class="s1">'Enter the new book name: '</span><span class="p">)</span>
    <span class="n">author</span> <span class="o">=</span> <span class="nb">input</span><span class="p">(</span><span class="s1">'Enter the new book author: '</span><span class="p">)</span>

    <span class="n">database</span><span class="o">.</span><span class="n">insert_book</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">author</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">list_books</span><span class="p">():</span>
    <span class="k">for</span> <span class="n">book</span> <span class="ow">in</span> <span class="n">database</span><span class="o">.</span><span class="n">get_all_books</span><span class="p">():</span>
        <span class="c1"># book[3] will be a falsy value (0) if not read</span>
        <span class="n">read</span> <span class="o">=</span> <span class="s1">'YES'</span> <span class="k">if</span> <span class="n">book</span><span class="p">[</span><span class="s1">'read'</span><span class="p">]</span> <span class="o">==</span> <span class="s1">'1'</span> <span class="k">else</span> <span class="s1">'NO'</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"</span><span class="si">{</span><span class="n">book</span><span class="p">[</span><span class="s1">'name'</span><span class="p">]</span><span class="si">}</span><span class="s2"> by </span><span class="si">{</span><span class="n">book</span><span class="p">[</span><span class="s1">'author'</span><span class="p">]</span><span class="si">}</span><span class="s2"> — Read: </span><span class="si">{</span><span class="n">read</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">prompt_read_book</span><span class="p">():</span>
    <span class="n">name</span> <span class="o">=</span> <span class="nb">input</span><span class="p">(</span><span class="s1">'Enter the name of the book you just finished reading: '</span><span class="p">)</span>

    <span class="n">database</span><span class="o">.</span><span class="n">mark_book_as_read</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">prompt_delete_book</span><span class="p">():</span>
    <span class="n">name</span> <span class="o">=</span> <span class="nb">input</span><span class="p">(</span><span class="s1">'Enter the name of the book you wish to delete: '</span><span class="p">)</span>

    <span class="n">database</span><span class="o">.</span><span class="n">delete_book</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>

<span class="n">menu</span><span class="p">()</span>
</code></pre></div>

<p>和一个包含数据存储代码的<code>database.py</code>文件:</p>
<div class="codehilite"><span class="filename">database.py</span><pre><span/><code><span class="kn">import</span> <span class="nn">json</span>

<span class="n">BOOKS_FILE</span> <span class="o">=</span> <span class="s1">'books.json'</span>

<span class="k">def</span> <span class="nf">create_book_table</span><span class="p">():</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">BOOKS_FILE</span><span class="p">,</span> <span class="s1">'x'</span><span class="p">)</span> <span class="k">as</span> <span class="n">file</span><span class="p">:</span>
            <span class="n">json</span><span class="o">.</span><span class="n">dump</span><span class="p">([],</span> <span class="n">file</span><span class="p">)</span>  <span class="c1"># initialize file as empty list</span>
    <span class="k">except</span> <span class="ne">FileExistsError</span><span class="p">:</span>
        <span class="k">pass</span>

<span class="k">def</span> <span class="nf">get_all_books</span><span class="p">():</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">books_file</span><span class="p">,</span> <span class="s1">'r'</span><span class="p">)</span> <span class="k">as</span> <span class="n">file</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">json</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">file</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">insert_book</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">author</span><span class="p">):</span>
    <span class="n">books</span> <span class="o">=</span> <span class="n">get_all_books</span><span class="p">()</span>
    <span class="n">books</span><span class="o">.</span><span class="n">append</span><span class="p">({</span><span class="s1">'name'</span><span class="p">:</span> <span class="n">name</span><span class="p">,</span> <span class="s1">'author'</span><span class="p">:</span> <span class="n">author</span><span class="p">,</span> <span class="s1">'read'</span><span class="p">:</span> <span class="kc">False</span><span class="p">})</span>
    <span class="n">save_all_books</span><span class="p">(</span><span class="n">books</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">save_all_books</span><span class="p">(</span><span class="n">books</span><span class="p">):</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">books_file</span><span class="p">,</span> <span class="s1">'w'</span><span class="p">)</span> <span class="k">as</span> <span class="n">file</span><span class="p">:</span>
        <span class="n">json</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">books</span><span class="p">,</span> <span class="n">file</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">mark_book_as_read</span><span class="p">(</span><span class="n">name</span><span class="p">):</span>
    <span class="n">books</span> <span class="o">=</span> <span class="n">get_all_books</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">book</span> <span class="ow">in</span> <span class="n">books</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">book</span><span class="p">[</span><span class="s1">'name'</span><span class="p">]</span> <span class="o">==</span> <span class="n">name</span><span class="p">:</span>
            <span class="n">book</span><span class="p">[</span><span class="s1">'read'</span><span class="p">]</span> <span class="o">=</span> <span class="s1">'1'</span>
    <span class="n">save_all_books</span><span class="p">(</span><span class="n">books</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">delete_book</span><span class="p">(</span><span class="n">name</span><span class="p">):</span>
    <span class="n">books</span> <span class="o">=</span> <span class="n">get_all_books</span><span class="p">()</span>
    <span class="n">books</span> <span class="o">=</span> <span class="p">[</span><span class="n">book</span> <span class="k">for</span> <span class="n">book</span> <span class="ow">in</span> <span class="n">books</span> <span class="k">if</span> <span class="n">book</span><span class="p">[</span><span class="s1">'name'</span><span class="p">]</span> <span class="o">!=</span> <span class="n">name</span><span class="p">]</span>
    <span class="n">save_all_books</span><span class="p">(</span><span class="n">books</span><span class="p">)</span>
</code></pre></div>

<p>如果您最终得到了不同的代码分割方式，不要担心！其实并没有什么对错之分。然而，我们很乐意在我们的<a href="https://discord.gg/BBWwyMq"> Discord服务器</a>上与你讨论这个问题。我们都可以学到新的东西！</p>
<p>感谢您参加我们的练习，记得还要处理今天的项目。今天是相当大的一个！</p>
<p>祝你好运，我们在那里见！</p>
<h2>额外资源</h2>
<p>如果您有兴趣了解关于<code>list_books</code>函数中这段语法的更多信息:</p>
<div class="codehilite"><pre><span/><code><span class="n">read</span> <span class="o">=</span> <span class="s1">'YES'</span> <span class="k">if</span> <span class="n">book</span><span class="p">[</span><span class="s1">'read'</span><span class="p">]</span> <span class="o">==</span> <span class="s1">'1'</span> <span class="k">else</span> <span class="s1">'NO'</span>
</code></pre></div>

<p>我们有<a href="https://blog.teclado.com/python-pythons-ternary-operator/">个帖子，你可以在我们的博客上查看</a>。</p> 
                </article>
            
            </div>    
</body>
</html>